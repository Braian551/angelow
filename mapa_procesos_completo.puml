@startuml Mapa de Procesos - Sistema Angelow
skinparam backgroundColor #FEFEFE
skinparam activity {
    BackgroundColor #FFFFFF
    BorderColor #333333
    BorderThickness 2
    FontSize 11
}

skinparam partition {
    BackgroundColor #F8F8F8
    BorderColor #666666
    BorderThickness 2
}

skinparam note {
    BackgroundColor #FFFACD
    BorderColor #FFA500
}

title Mapa de Procesos - Sistema Angelow

start

partition "Proceso de Exploración y Registro" as Exploration {
    :Usuario accede a tienda;
    :Explora página principal;
    :Navega por categorías;
    :Busca productos;

    if (¿Usuario registrado?) then (No)
        :Muestra productos limitados;
        :Ofrece registro/login;
        if (¿Desea registrarse?) then (Sí)
            :Ingresa datos personales;
            :Valida email único;
            :Crea cuenta nueva;
            :Envía email confirmación;
            :Usuario autenticado;
        else (No)
            :Continúa como invitado;
        endif
    else (Sí)
        :Usuario ya autenticado;
        :Acceso completo a funciones;
    endif
}

partition "Proceso de Compra" as Purchase {
    :Selecciona producto;
    :Ve detalles y variantes;
    :Elige talla/color/cantidad;

    if (¿Requiere autenticación?) then (Sí)
        :Redirige a login;
        :Usuario se autentica;
    endif

    :Agrega producto al carrito;
    :Gestiona items del carrito;
    :Aplica códigos descuento (opcional);
    :Calcula costos de envío;

    if (¿Proceder al pago?) then (Sí)
        :Inicia checkout;
        :Selecciona dirección envío;
        :Elige método de pago;
    else (No)
        :Continúa comprando;
        end
    endif
}

partition "Proceso de Pago" as Payment {
    :Muestra datos bancarios;
    :Usuario realiza transferencia externa;
    :Sube comprobante de pago;
    :Sistema recibe comprobante;

    note right
        Comprobante se almacena
        para validación manual
    end note

    :Crea registro de orden;
    :Asigna número de orden único;
    :Guarda detalles de compra;
    :Actualiza inventario;
}

partition "Proceso de Gestión de Pedidos" as OrderManagement {
    :Orden creada en estado "Pendiente";
    :Envía confirmación por email;
    :Cliente puede ver en historial;

    fork
        :Proceso de validación de pago;
        :Administrador revisa comprobante;
        if (¿Pago válido?) then (Sí)
            :Aprueba pago;
            :Cambia estado a "Pagado";
            :Envía notificación cliente;
        else (No)
            :Rechaza pago;
            :Solicita nuevo comprobante;
            :Notifica cliente;
            end
        endif
    fork again
        :Proceso de preparación;
        :Verifica stock disponible;
        if (¿Stock suficiente?) then (Sí)
            :Prepara productos;
            :Empaqueta orden;
            :Cambia estado a "Preparando";
        else (No)
            :Notifica falta de stock;
            :Cancela orden automáticamente;
            end
        endif
    fork again
        :Espera asignación de delivery;
    join

    :Administrador asigna delivery;
    :Notifica repartidor;
    :Cambia estado a "Enviando";
}

partition "Proceso de Delivery" as Delivery {
    :Repartidor recibe notificación;
    :Ve órdenes asignadas;
    :Acepta orden de entrega;

    if (¿Acepta orden?) then (Sí)
        :Inicia navegación GPS;
        :Calcula ruta óptima;
        :Comienza seguimiento en tiempo real;

        note right
            GPS actualiza ubicación
            cada 30 segundos
        end note

        :Cambia estado a "En camino";
        :Cliente puede rastrear ubicación;

        :Llega a dirección de entrega;
        :Cambia estado a "En destino";

        :Entrega productos;
        :Cliente confirma recepción;
        :Cambia estado a "Entregado";

        note right
            Sistema registra
            fecha/hora entrega
        end note

    else (No)
        :Rechaza orden;
        :Administrador reasigna;
    endif
}

partition "Procesos Administrativos" as Admin {
    fork
        :Gestión de productos;
        :CRUD productos/variantes;
        :Control de inventario;
        :Alertas stock bajo;
    fork again
        :Gestión de categorías;
        :Crear/editar categorías;
        :Asignar productos;
    fork again
        :Gestión de pedidos;
        :Ver todas las órdenes;
        :Cambiar estados;
        :Resolver problemas;
    fork again
        :Reportes y análisis;
        :Generar reportes ventas;
        :Análisis productos;
        :Reportes clientes;
    fork again
        :Gestión de usuarios;
        :Administrar cuentas;
        :Gestionar roles;
    fork again
        :Configuración sistema;
        :Sliders y banners;
        :Descuentos promociones;
        :Reglas de envío;
    join
}

partition "Procesos de Seguimiento Post-Entrega" as PostDelivery {
    :Orden en estado "Entregado";
    :Cliente puede calificar servicio;
    :Cliente puede dejar reseña;

    if (¿Cliente deja reseña?) then (Sí)
        :Guarda reseña en base datos;
        :Actualiza calificación producto;
    endif

    :Cliente puede reordenar productos;
    :Historial completo disponible;

    note right
        Sistema mantiene
        registro completo
        de la transacción
    end note
}

:Fin del proceso;

stop

' ===== CONEXIONES ENTRE PROCESOS =====
Exploration --> Purchase : Usuario autenticado
Purchase --> Payment : Checkout completado
Payment --> OrderManagement : Orden creada
OrderManagement --> Delivery : Delivery asignado
Delivery --> PostDelivery : Entrega completada
Admin --> OrderManagement : Gestión continua
Admin --> Delivery : Asignación delivery

' ===== NOTAS ADICIONALES =====
note as N1
    **Características del Sistema:**
    - 85% completitud
    - 80+ tablas en BD
    - Sistema GPS avanzado
    - Pagos por transferencia
    - Arquitectura modular
end note

note as N2
    **Tiempos Estimados:**
    - Exploración: Inmediato
    - Pago: 1-2 días (transferencia)
    - Preparación: 2-4 horas
    - Entrega: 1-3 horas
end note

note as N3
    **Puntos de Decisión Críticos:**
    - Autenticación requerida
    - Validación de pagos
    - Disponibilidad de stock
    - Aceptación de delivery
end note

@enduml