# Matriz de Requisitos Completa - Sistema Angelow

Esta matriz consolida todos los requisitos funcionales, reglas de negocio y requerimientos de información del sistema Angelow.

## 1. Gestión de Usuarios y Accesos
**Fuente:** `users/`, `login.php`, `register.php`

| ID | Requisito | Detalle (Descripción, Reglas, Datos) |
|---|---|---|
| **RF-001** | Registro de usuarios | **Descripción:** El sistema debe permitir a los visitantes registrarse creando una cuenta nueva con correo electrónico, nombre completo, teléfono y contraseña.<br><br>**RN-001:** Para crear una cuenta, debes aceptar obligatoriamente los términos y condiciones marcando la casilla de aceptación. Sin esta confirmación no se puede completar el registro.<br><br>**RI-001:** Nombre completo del usuario, correo electrónico único, número de teléfono, contraseña encriptada, fecha de registro, aceptación de términos y condiciones. |
| **RF-002** | Inicio de sesión | **Descripción:** El sistema debe permitir a los usuarios registrados iniciar sesión con su correo electrónico y contraseña, con opción de "Recordar mi cuenta".<br><br>**RN-002:** Si activas la opción "Recordar mi cuenta", el sistema mantendrá tu sesión activa por 30 días. De lo contrario, la sesión se cerrará automáticamente al cerrar el navegador por seguridad.<br><br>**RI-002:** Correo electrónico de acceso, contraseña para validación, token de sesión único, fecha de expiración del token, dirección IP del dispositivo y estado de la sesión recordada. |
| **RF-003** | Ver perfil de usuario | **Descripción:** El sistema debe permitir a los usuarios ver su información personal completa en su perfil (nombre, correo, teléfono, foto de perfil).<br><br>**RN-003:** Cada usuario solo puede ver su propia información personal. No tiene acceso a los datos de otros usuarios, garantizando la privacidad de todos.<br><br>**RI-003:** Identificador único del usuario, nombre completo, correo electrónico, número de teléfono, foto de perfil, rol del usuario y fecha de último acceso. |
| **RF-004** | Editar perfil de usuario | **Descripción:** El sistema debe permitir a los usuarios modificar su información personal: nombre, teléfono y foto de perfil.<br><br>**RN-004:** El correo electrónico no puede modificarse una vez creada la cuenta, ya que es el identificador único para iniciar sesión. Para cambiar el correo debes contactar al administrador.<br><br>**RI-004:** Nombre completo actualizado, número de teléfono actualizado, foto de perfil nueva (formatos JPG, PNG, máximo 2MB) y fecha de última actualización del perfil. |
| **RF-005** | Registro con Google | **Descripción:** El sistema debe permitir a los visitantes registrarse usando su cuenta de Google, creando automáticamente su perfil con los datos de Google.<br><br>**RN-005:** Si te registras con Google, tu correo, nombre y foto se importan automáticamente desde tu cuenta de Google. No necesitas crear ni recordar una contraseña adicional para la tienda.<br><br>**RI-005:** Identificador único de Google del usuario, correo electrónico de Google, nombre completo de Google, foto de perfil de Google y tokens de acceso y actualización de Google. |
| **RF-006** | Inicio de sesión con Google | **Descripción:** El sistema debe permitir a los usuarios iniciar sesión usando su cuenta de Google sin necesidad de contraseña.<br><br>**RN-006:** Cuando inicias sesión con Google, el sistema valida automáticamente tu identidad con los servidores de Google. No necesitas ingresar contraseña. Si es tu primera vez, se crea automáticamente tu cuenta.<br><br>**RI-006:** Identificador de Google para validación, tokens temporales de autenticación de Google y fecha y hora del último inicio de sesión con Google. |
| **RF-007** | Agregar dirección | **Descripción:** El sistema debe permitir a los usuarios agregar nuevas direcciones de envío con coordenadas GPS, nombre del receptor y teléfono de contacto.<br><br>**RN-007:** Al guardar una dirección de envío, debes incluir obligatoriamente su ubicación exacta en el mapa (coordenadas GPS). Esto es esencial para que los repartidores puedan llegar precisamente a tu domicilio.<br><br>**RI-007:** Dirección completa de texto, barrio, ciudad, coordenadas GPS obligatorias (latitud y longitud), nombre del receptor, teléfono del receptor e instrucciones especiales de entrega opcionales. |
| **RF-008** | Ver direcciones | **Descripción:** El sistema debe permitir a los usuarios visualizar todas sus direcciones guardadas con su información completa y ubicación en el mapa.<br><br>**RN-008:** Puedes guardar múltiples direcciones de envío (casa, trabajo, casa de familiares). Cada una se muestra con su mapa de ubicación y puedes elegir cuál usar al momento de hacer una compra.<br><br>**RI-008:** Listado completo de direcciones del usuario: dirección completa, barrio, ciudad, coordenadas GPS, nombre y teléfono del receptor, indicador de dirección predeterminada y fecha de creación. |
| **RF-009** | Editar dirección | **Descripción:** El sistema debe permitir a los usuarios modificar cualquier dato de sus direcciones guardadas, incluyendo actualizar las coordenadas GPS.<br><br>**RN-009:** Puedes actualizar cualquier dato de tus direcciones: cambiar el nombre del receptor, actualizar el teléfono, modificar instrucciones de entrega o corregir la ubicación en el mapa arrastrando el marcador.<br><br>**RI-009:** Identificador de la dirección a modificar, nuevos valores para: dirección, barrio, coordenadas GPS, nombre receptor, teléfono receptor, instrucciones de entrega y fecha de última actualización. |
| **RF-010** | Eliminar dirección | **Descripción:** El sistema debe permitir a los usuarios eliminar direcciones que ya no utilizan de su lista de direcciones guardadas.<br><br>**RN-010:** Antes de eliminar una dirección, el sistema te pedirá confirmación para evitar borrados accidentales. No puedes eliminar una dirección que esté asociada a pedidos pendientes o en proceso de entrega.<br><br>**RI-010:** Identificador de la dirección a eliminar, verificación de que no hay pedidos activos usando esa dirección y fecha de eliminación para auditoría. |
| **RF-011** | Control de acceso por roles | **Descripción:** El sistema debe redirigir automáticamente a cada usuario a su panel correspondiente según su rol al iniciar sesión (admin, customer).<br><br>**RN-011:** Cada tipo de usuario tiene acceso solo a las secciones que le corresponden. Los clientes ven su perfil y pedidos, y los administradores el panel completo de gestión de la tienda.<br><br>**RI-011:** Rol del usuario (admin o customer), página de inicio correspondiente al rol, permisos asociados al rol y fecha de asignación del rol. |
| **RF-012** | Restricción de acceso | **Descripción:** El sistema debe bloquear el acceso a secciones no autorizadas y redirigir al usuario a su área correspondiente si intenta acceder a URLs restringidas.<br><br>**RN-012:** Si intentas acceder a una sección no autorizada para tu rol (por ejemplo, un cliente intentando entrar al panel de administración), serás redirigido automáticamente a tu panel principal con un mensaje informativo.<br><br>**RI-012:** URL solicitada, rol del usuario que intenta acceder, permisos requeridos para esa URL, acción tomada (permitir o redirigir) y registro del intento de acceso para auditoría. |
| **RF-013** | Ver configuración | **Descripción:** El sistema debe permitir a los usuarios visualizar sus preferencias de notificaciones, configuración de privacidad y opciones de cuenta.<br><br>**RN-013:** En tu configuración de cuenta puedes ver y ajustar qué notificaciones deseas recibir por correo: actualizaciones de tus pedidos, alertas de productos favoritos y ofertas especiales.<br><br>**RI-013:** Preferencias de notificaciones por correo (órdenes, alertas de productos, ofertas), configuración de privacidad actual y opciones de seguridad de la cuenta. |
| **RF-014** | Actualizar configuración | **Descripción:** El sistema debe permitir a los usuarios modificar sus preferencias de notificaciones, cambiar su contraseña y ajustar opciones de privacidad.<br><br>**RN-014:** Puedes activar o desactivar cada tipo de notificación individualmente según tu preferencia. Para cambiar la contraseña, debes ingresar primero tu contraseña actual como medida de seguridad.<br><br>**RI-014:** Nuevas preferencias de notificaciones seleccionadas, contraseña actual para validación, nueva contraseña encriptada, opciones de privacidad actualizadas y fecha de modificación de la configuración. |
| **RF-015** | Registro automático de cambios | **Descripción:** El sistema debe registrar automáticamente todos los cambios en las cuentas de usuario (modificación de datos, cambio de rol, cambio de contraseña).<br><br>**RN-015:** Todas las modificaciones en cuentas de usuario quedan registradas permanentemente con detalles de qué cambió, quién lo hizo, desde dónde (dirección IP) y cuándo. Estos registros no pueden modificarse ni eliminarse.<br><br>**RI-015:** Identificador del usuario modificado, tipo de cambio realizado (perfil, rol, contraseña, estado), valores anteriores y nuevos, identificador del usuario que hizo el cambio, dirección IP, fecha y hora del cambio. |
| **RF-016** | Consulta de auditoría | **Descripción:** El sistema debe permitir a los administradores consultar el historial completo de cambios de cualquier usuario para fines de auditoría.<br><br>**RN-016:** Solo los administradores pueden consultar los registros de auditoría de usuarios. Estos registros muestran cada cambio con lujo de detalles para tener trazabilidad completa y cumplimiento de protección de datos.<br><br>**RI-016:** Historial completo de cambios del usuario filtrable por: tipo de acción, rango de fechas y usuario ejecutor. Cada registro incluye acción, valores antes/después, IP y fecha/hora. |

## 2. Gestión de Productos e Inventario
**Fuente:** `admin/products.php`, `admin/inventario/`

| ID | Requisito | Detalle (Descripción, Reglas, Datos) |
|---|---|---|
| **RF-017** | Registrar producto | **Descripción:** El sistema debe permitir a los administradores registrar nuevos productos con información básica: nombre, descripción, precio, categoría y género (niño/niña/bebé).<br><br>**RN-017:** Solo los administradores pueden crear productos en el catálogo. Todos los productos deben tener nombre, precio y categoría como datos obligatorios. La descripción ayuda a que los clientes conozcan mejor el producto.<br><br>**RI-017:** Nombre del producto, descripción detallada, precio base en pesos colombianos, identificador de la categoría, género (niño/niña/bebé/unisex), estado inicial (activo/inactivo) y fecha de creación. |
| **RF-018** | Mostrar productos | **Descripción:** El sistema debe permitir a los administradores visualizar el listado completo de todos los productos con su información principal, variantes y stock disponible.<br><br>**RN-018:** El listado de productos muestra información resumida de cada uno: nombre, imagen principal, precio, categoría, género, cantidad de variantes, stock total y estado (activo/inactivo). Puedes buscar y filtrar para encontrar productos específicos fácilmente.<br><br>**RI-018:** Listado de productos con: identificador, nombre, imagen principal, precio, categoría, género, cantidad de variantes de color, cantidad de variantes de talla, stock total, estado y opciones de acciones (editar, eliminar). |
| **RF-019** | Actualizar producto | **Descripción:** El sistema debe permitir a los administradores modificar cualquier información de productos existentes: nombre, descripción, precio, categoría, género o estado.<br><br>**RN-019:** Los cambios en productos se reflejan inmediatamente en la tienda. Si cambias el precio, el nuevo precio se muestra de inmediato para los clientes. Todos los cambios quedan registrados en el historial de auditoría automáticamente.<br><br>**RI-019:** Identificador del producto a modificar, nuevos valores para: nombre, descripción, precio, categoría, género, estado, usuario administrador que realiza el cambio y fecha de última actualización. |
| **RF-020** | Eliminar producto | **Descripción:** El sistema debe permitir a los administradores eliminar productos del catálogo que ya no se comercializan.<br><br>**RN-020:** No puedes eliminar un producto que tenga pedidos pendientes o en proceso. El sistema te pedirá confirmación antes de eliminar para evitar borrados accidentales. La eliminación también borra todas sus variantes, imágenes y relaciones con colecciones.<br><br>**RI-020:** Identificador del producto a eliminar, verificación de ausencia de pedidos activos, eliminación en cascada de variantes e imágenes, usuario que elimina, motivo de eliminación y fecha de eliminación para auditoría. |
| **RF-021** | Agregar variante de color | **Descripción:** El sistema debe permitir a los administradores agregar variantes de color a productos, asociando cada color con un código SKU único.<br><br>**RN-021:** Cada combinación de producto y color genera un código SKU único automáticamente para control de inventario. Los colores disponibles se muestran con su representación visual real (código hexadecimal) para que los clientes vean el tono exacto.<br><br>**RI-021:** Identificador del producto, identificador del color (de catálogo de colores), código SKU único generado automáticamente, estado de la variante (activa/inactiva) y fecha de creación de la variante. |
| **RF-022** | Mostrar variantes de color | **Descripción:** El sistema debe permitir visualizar todas las variantes de color de un producto con su información completa, imágenes específicas y stock disponible.<br><br>**RN-022:** Cada variante de color puede tener sus propias fotos exclusivas mostrando cómo luce el producto en ese color específico. El stock se controla de manera independiente por cada combinación de color y talla.<br><br>**RI-022:** Listado de variantes de color del producto con: color (nombre y código hexadecimal), código SKU, imágenes asociadas a esa variante, stock total de ese color (suma de todas las tallas) y estado. |
| **RF-023** | Eliminar variante de color | **Descripción:** El sistema debe permitir a los administradores eliminar variantes de color que ya no están disponibles, liberando espacio en el catálogo.<br><br>**RN-023:** No puedes eliminar una variante de color que esté en pedidos pendientes o en carritos de compra activos. El sistema te avisará cuántos carritos tienen ese producto y te pedirá confirmación antes de eliminar.<br><br>**RI-023:** Identificador de la variante de color, verificación de ausencia en pedidos activos y carritos, eliminación de imágenes asociadas, usuario administrador que elimina y fecha de eliminación. |
| **RF-024** | Agregar variante de talla | **Descripción:** El sistema debe permitir a los administradores agregar variantes de talla a productos con control de stock independiente por talla.<br><br>**RN-024:** Cada talla de producto (XS, S, M, L, XL, 0-3M, 3-6M, etc.) tiene su propio inventario independiente. Al agregar una talla nueva, puedes definir cuántas unidades hay disponibles inicialmente.<br><br>**RI-024:** Identificador del producto, identificador de la talla (de catálogo de tallas), cantidad de stock inicial para esa talla, umbral de alerta de bajo inventario y fecha de creación de la variante. |
| **RF-025** | Mostrar variantes de talla | **Descripción:** El sistema debe permitir visualizar todas las variantes de talla de un producto con su stock disponible actual y umbral de alerta.<br><br>**RN-025:** Las tallas se muestran en orden lógico (de menor a mayor tamaño). Si el stock de alguna talla está por debajo del umbral configurado, se resalta visualmente para alertar al administrador que debe reabastecer.<br><br>**RI-025:** Listado de variantes de talla del producto con: nombre de la talla, código de la talla, stock disponible actual, umbral de alerta, indicador visual de stock bajo y estado (activa/inactiva). |
| **RF-026** | Eliminar variante de talla | **Descripción:** El sistema debe permitir a los administradores eliminar variantes de talla que ya no se ofrecen en el producto.<br><br>**RN-026:** Antes de eliminar una talla, el sistema verifica que no existan pedidos pendientes con esa talla específica. Si hay pedidos activos, no se permite la eliminación hasta que se completen o cancelen esos pedidos.<br><br>**RI-026:** Identificador de la variante de talla, verificación de ausencia en pedidos activos, registro del stock eliminado para auditoría, usuario que elimina y fecha de eliminación. |
| **RF-027** | Visualizar categorías | **Descripción:** El sistema debe permitir visualizar el listado completo de categorías de productos disponibles para organizar el catálogo.<br><br>**RN-027:** Las categorías organizan los productos para que los clientes encuentren fácilmente lo que buscan (vestidos, camisetas, pantalones, etc.). Todos los productos deben pertenecer a una categoría. Las categorías activas aparecen en el menú principal de la tienda.<br><br>**RI-027:** Listado de categorías con: identificador, nombre de la categoría, identificador de URL amigable (slug), descripción, cantidad de productos en esa categoría, estado (activa/inactiva) y orden de visualización en el menú. |
| **RF-028** | Ver inventario general | **Descripción:** El sistema debe permitir a los administradores visualizar el inventario completo con stock de todas las variantes de productos, con alertas de bajo inventario.<br><br>**RN-028:** El inventario muestra stock en tiempo real de cada producto por color y talla. Los productos con stock bajo (según umbral configurado) se destacan con color rojo para alertar que necesitan reabastecimiento urgente.<br><br>**RI-028:** Listado de inventario con: producto, variante de color, variante de talla, stock disponible actual, umbral de alerta, indicador de stock bajo/crítico/agotado, fecha de última actualización del stock. |
| **RF-029** | Ajustar stock manualmente | **Descripción:** El sistema debe permitir a los administradores ajustar manualmente el stock de productos (agregar, reducir o transferir entre variantes) con motivo obligatorio.<br><br>**RN-029:** Cada ajuste manual de inventario requiere especificar el motivo (reabastecimiento, corrección, merma, devolución, etc.). Todos los movimientos quedan registrados automáticamente con quién lo hizo, cuándo y por qué.<br><br>**RI-029:** Identificador de la variante (producto+color+talla), tipo de movimiento (entrada/salida/transferencia), cantidad modificada, stock anterior, stock resultante, motivo del ajuste, usuario responsable y fecha del movimiento. |
| **RF-030** | Ver historial de movimientos | **Descripción:** El sistema debe permitir consultar el historial completo de movimientos de inventario filtrable por producto, fecha, tipo de movimiento y usuario responsable.<br><br>**RN-030:** El historial de inventario es permanente e inalterable, permitiendo auditorías completas. Puedes ver todos los movimientos: ventas (automáticas), devoluciones, ajustes manuales, transferencias y correcciones, con trazabilidad completa.<br><br>**RI-030:** Historial de movimientos con: fecha y hora, producto y variante afectada, tipo de movimiento, cantidad, stock antes/después, motivo, usuario responsable, pedido relacionado (si aplica) y notas adicionales. |
| **RF-031** | Actualización automática por ventas | **Descripción:** El sistema debe actualizar automáticamente el inventario cuando se confirma una orden de compra, descontando las unidades vendidas del stock.<br><br>**RN-031:** Cuando un cliente completa su compra, el inventario se descuenta automáticamente de cada variante comprada. Si el pago es rechazado o el pedido se cancela, el stock se reintegra automáticamente. Esto evita sobreventa.<br><br>**RI-031:** Movimiento automático de inventario: identificadores de las variantes vendidas, cantidades descontadas, número de pedido asociado, estado del pago, stock antes/después y fecha del movimiento automático. |
| **RF-032** | Subir imágenes generales | **Descripción:** El sistema debe permitir a los administradores subir imágenes generales del producto que se mostrarán en el catálogo principal.<br><br>**RN-032:** Las imágenes deben estar en formato JPG, PNG o WEBP con tamaño máximo de 2 MB cada una. Puedes subir múltiples imágenes y definir cuál es la imagen principal que aparecerá en el listado de productos.<br><br>**RI-032:** Identificador del producto, archivo de imagen (JPG/PNG/WEBP, máximo 2MB), ruta de almacenamiento de la imagen, orden de visualización, indicador de imagen principal y fecha de subida. |
| **RF-033** | Subir imágenes por variante de color | **Descripción:** El sistema debe permitir subir imágenes específicas para cada variante de color, mostrando cómo luce el producto en ese color exacto.<br><br>**RN-033:** Cada variante de color puede tener múltiples fotos exclusivas desde diferentes ángulos. Cuando un cliente selecciona un color en la tienda, las imágenes cambian automáticamente para mostrar ese color específico.<br><br>**RI-033:** Identificador de la variante de color, archivo de imagen, ruta de almacenamiento, orden de visualización de la imagen dentro de esa variante, indicador de imagen principal del color y fecha de subida. |
| **RF-034** | Visualizar imágenes | **Descripción:** El sistema debe permitir ver todas las imágenes asociadas a un producto (generales y por variante de color) en una galería organizada.<br><br>**RN-034:** La galería de imágenes se organiza mostrando primero las imágenes generales del producto, seguidas por las imágenes específicas de cada variante de color. Puedes reordenar las imágenes arrastrándolas con el mouse.<br><br>**RI-034:** Galería completa de imágenes del producto: imágenes generales ordenadas, imágenes por variante de color agrupadas, indicador de imagen principal, orden de visualización y opciones de acciones (reordenar, eliminar). |
| **RF-035** | Eliminar imágenes | **Descripción:** El sistema debe permitir a los administradores eliminar imágenes de productos o variantes, liberando espacio de almacenamiento.<br><br>**RN-035:** Cada producto debe tener al menos una imagen. El sistema no te permitirá eliminar la última imagen de un producto. Si quieres cambiarla, primero debes subir la nueva imagen y luego podrás eliminar la antigua.<br><br>**RI-035:** Identificador de la imagen a eliminar, ruta del archivo físico para eliminación, verificación de que no es la última imagen del producto, usuario que elimina y fecha de eliminación. |
| **RF-036** | Registro automático de cambios | **Descripción:** El sistema debe registrar automáticamente todos los cambios en productos e inventario para mantener trazabilidad completa.<br><br>**RN-036:** Todos los cambios en productos (precio, descripción, categoría) e inventario (stock, movimientos) quedan registrados automáticamente con: qué cambió, valor anterior, valor nuevo, quién lo hizo y cuándo. Estos registros son permanentes e inalterables.<br><br>**RI-036:** Registro de auditoría con: identificador del producto, campo modificado, valor anterior, valor nuevo, tipo de cambio (producto/inventario), usuario responsable, fecha y hora del cambio y motivo (si aplica). |
| **RF-037** | Consulta de auditoría | **Descripción:** El sistema debe permitir a los administradores consultar el historial completo de cambios de cualquier producto o movimiento de inventario.<br><br>**RN-037:** Los reportes de auditoría son filtrados por: producto específico, rango de fechas, tipo de cambio y usuario ejecutor. Sirven para resolver disputas, identificar errores, analizar tendencias de precio y cumplir con auditorías contables.<br><br>**RI-037:** Historial completo de cambios filtrable con: producto, tipo de acción, valores antes/después, usuario, fecha/hora. Exportable a Excel o PDF para reportes formales de auditoría. |

## 3. Experiencia de Compra (Tienda)
**Fuente:** `tienda/`, `cart.php`, `wishlist.php`

| ID | Requisito | Detalle (Descripción, Reglas, Datos) |
|---|---|---|
| **RF-071** | Buscar productos | **Descripción:** El sistema debe permitir buscar productos por nombre, descripción o categoría de forma instantánea con sugerencias mientras escribes.<br><br>**RN-071:** La búsqueda es case-insensitive (no diferencia mayúsculas/minúsculas) y tolerante a errores. Prioriza productos cuyo nombre comienza con lo que escribiste. Muestra sugerencias después de escribir 3 caracteres. La búsqueda es instantánea sin necesidad de presionar Enter.<br><br>**RI-071:** Término de búsqueda ingresado, resultados encontrados (productos con: nombre, imagen, precio, categoría), cantidad total de resultados, tiempo de respuesta de la búsqueda y ordenamiento de resultados por relevancia. |
| **RF-072** | Guardar historial de búsquedas | **Descripción:** El sistema debe registrar automáticamente cada búsqueda realizada con el término buscado, cantidad de resultados y fecha para análisis posteriores.<br><br>**RN-072:** Cada búsqueda queda registrada para análisis de tendencias y mejora del catálogo. Se identifica qué términos generan más búsquedas, cuáles no encuentran resultados (productos faltantes) y patrones de búsqueda de los clientes.<br><br>**RI-072:** Término buscado, identificador del usuario (opcional para usuarios no registrados), cantidad de resultados encontrados, producto clickeado (si aplica), fecha y hora de la búsqueda y dispositivo utilizado (móvil/escritorio). |
| **RF-073** | Mostrar búsquedas populares | **Descripción:** El sistema debe mostrar las búsquedas más populares como sugerencias rápidas para facilitar la navegación de los clientes.<br><br>**RN-073:** Las búsquedas populares se calculan contando cuántas veces se ha buscado cada término en los últimos 30 días. Se muestran máximo las 10 búsquedas más frecuentes. Se actualizan diariamente para reflejar tendencias actuales.<br><br>**RI-073:** Listado de términos de búsqueda más populares con: término, cantidad de veces buscado en período de tiempo, cantidad promedio de resultados y enlace directo a los resultados de esa búsqueda. |
| **RF-074** | Búsquedas sin resultados | **Descripción:** El sistema debe registrar las búsquedas que no encuentran productos para identificar oportunidades de ampliar el catálogo.<br><br>**RN-074:** Los administradores pueden ver un reporte de términos buscados que no devolvieron resultados, ordenados por frecuencia. Esto identifica qué productos o categorías están buscando los clientes pero no están disponibles en el catálogo.<br><br>**RI-074:** Reporte de búsquedas sin resultados con: término buscado, cantidad de veces buscado sin resultados, fechas de las búsquedas y sugerencias automáticas de productos similares para agregar al catálogo. |
| **RF-075** | Filtrar por categoría | **Descripción:** El sistema debe permitir filtrar productos por categoría específica mostrando solo los productos que pertenecen a esa categoría.<br><br>**RN-075:** Al seleccionar una categoría (vestidos, camisetas, pantalones, etc.), se muestran solo productos de esa categoría. El contador muestra cuántos productos tiene cada categoría. Las categorías sin productos no se muestran en los filtros.<br><br>**RI-075:** Categoría seleccionada, productos filtrados por esa categoría, cantidad de productos en la categoría, subcategorías disponibles (si aplica) y opciones de ordenamiento de resultados. |
| **RF-076** | Filtrar por rango de precio | **Descripción:** El sistema debe permitir filtrar productos por rango de precio usando un control deslizante con precio mínimo y máximo.<br><br>**RN-076:** Puedes definir un rango de precio personalizado arrastrando los controles deslizantes o ingresando valores específicos. El sistema muestra automáticamente solo productos dentro de ese rango. Los valores extremos se ajustan a los precios reales disponibles.<br><br>**RI-076:** Precio mínimo seleccionado, precio máximo seleccionado, precio mínimo disponible en catálogo, precio máximo disponible en catálogo, productos filtrados por rango y cantidad de resultados encontrados. |
| **RF-077** | Filtrar por género | **Descripción:** El sistema debe permitir filtrar productos por género (niño, niña, bebé, unisex) mostrando solo productos apropiados para la selección.<br><br>**RN-077:** Puedes seleccionar uno o múltiples géneros simultáneamente. Si seleccionas "niña" y "bebé", se mostrarán productos de ambas categorías. Cada opción muestra el contador de productos disponibles. Los filtros se pueden combinar con categorías y precios.<br><br>**RI-077:** Géneros seleccionados (niño/niña/bebé/unisex), productos filtrados por género(s), cantidad de productos por género, combinación con otros filtros activos y ordenamiento de resultados. |
| **RF-038** | Agregar al carrito | **Descripción:** El sistema debe permitir a los usuarios agregar productos al carrito seleccionando color, talla y cantidad deseada.<br><br>**RN-038:** Al agregar un producto al carrito, el sistema verifica inmediatamente si hay stock disponible del color y talla seleccionados. Si está agotado, se mostrará un mensaje informativo y no se podrá agregar.<br><br>**RI-038:** Identificador del producto, variante de color seleccionada, variante de talla seleccionada, cantidad a agregar, stock disponible de esa combinación, precio unitario y fecha de agregado al carrito. |
| **RF-039** | Ver carrito | **Descripción:** El sistema debe permitir a los usuarios visualizar todos los productos en su carrito con imagen, nombre, color, talla, cantidad, precio unitario y subtotal.<br><br>**RN-039:** En el carrito puedes ver todos los productos que vas a comprar con su foto, nombre, color, talla, precio y cantidad. El subtotal se calcula automáticamente multiplicando precio por cantidad. El total general se muestra al final.<br><br>**RI-039:** Listado de ítems del carrito con: identificador del ítem, producto con imagen, color y talla seleccionados, cantidad, precio unitario, subtotal del ítem, contador total de productos y suma total del carrito. |
| **RF-040** | Actualizar cantidad | **Descripción:** El sistema debe permitir modificar la cantidad de productos en el carrito, aumentando o disminuyendo según disponibilidad de stock.<br><br>**RN-040:** La cantidad en el carrito no puede superar las unidades disponibles en inventario. Si intentas agregar más de lo disponible, el sistema te informará cuántas unidades puedes comprar como máximo. Los totales se actualizan automáticamente sin recargar la página.<br><br>**RI-040:** Identificador del ítem del carrito, nueva cantidad solicitada, cantidad disponible en inventario, nueva cantidad validada (no puede exceder stock), nuevo subtotal calculado y fecha de actualización. |
| **RF-041** | Eliminar del carrito | **Descripción:** El sistema debe permitir eliminar productos individuales del carrito de compras de forma instantánea.<br><br>**RN-041:** Al eliminar un producto del carrito, se libera inmediatamente ese stock para que otros clientes puedan comprarlo. El carrito se actualiza automáticamente mostrando el nuevo total sin ese producto.<br><br>**RI-041:** Identificador del ítem a eliminar, producto eliminado (para confirmación), nuevo total del carrito sin ese ítem y fecha de eliminación. |
| **RF-042** | Compra inmediata | **Descripción:** El sistema debe permitir iniciar una compra inmediata desde la ficha de producto, creando un carrito temporal que lleva al cliente directamente al paso de envío sin mezclar esos artículos con su carrito habitual.<br><br>**RN-042:** Al usar "Comprar ahora" se crea un carrito aislado asociado al usuario o a su sesión. El sistema valida que el carrito pertenezca al cliente antes de continuar, elimina la bandera de compra inmediata tras usarla y, si no coincide, redirige al carrito estándar para evitar compras duplicadas.<br><br>**RI-042:** Identificador del carrito temporal, indicador buy_now, usuario y/o session_id asociados, productos y cantidades incluidos, hora de creación, subtotal calculado y referencia al carrito principal si existe. |
| **RF-101** | Agregar a Wishlist | **Descripción:** El sistema debe permitir a los usuarios agregar productos a su lista de favoritos haciendo clic en el icono de corazón.<br><br>**RN-101:** Solo usuarios registrados pueden agregar productos a favoritos. El corazón cambia de color inmediatamente al agregarse. No puedes agregar el mismo producto dos veces. Tu lista se mantiene sincronizada en todas las páginas que tengas abiertas simultáneamente.<br><br>**RI-101:** Identificador del usuario, identificador del producto, fecha de agregado a favoritos. Relación única usuario-producto (sin duplicados). |
| **RF-102** | Ver mi Wishlist | **Descripción:** El sistema debe permitir visualizar la lista completa de productos favoritos con imagen, nombre, precio actualizado y disponibilidad.<br><br>**RN-102:** Tu lista de favoritos es personal y privada. Para cada producto verás su imagen, nombre, precio actual (actualizado en tiempo real), disponibilidad de stock y botón para agregar al carrito. Un contador en el menú muestra cuántos favoritos tienes.<br><br>**RI-102:** Listado de productos en wishlist con: imagen del producto, nombre, precio actualizado, indicador de disponibilidad (en stock/agotado), fecha de agregado a favoritos y opciones (eliminar de favoritos, agregar al carrito). |
| **RF-103** | Eliminar de Wishlist | **Descripción:** El sistema debe permitir eliminar productos individuales de la lista de favoritos de forma instantánea.<br><br>**RN-103:** Puedes eliminar productos de tu lista de favoritos haciendo clic nuevamente en el corazón o desde la página de favoritos. El cambio es inmediato. El contador de favoritos se actualiza automáticamente. No hay confirmación para evitar pasos innecesarios.<br><br>**RI-103:** Identificador del usuario, identificador del producto a eliminar, fecha de eliminación y actualización del contador de favoritos del usuario. |
| **RF-104** | Hacer pregunta sobre producto | **Descripción:** El sistema debe permitir a los usuarios hacer preguntas sobre productos directamente desde la página del producto.<br><br>**RN-104:** Solo usuarios registrados pueden hacer preguntas. Las preguntas tienen máximo 500 caracteres. Quedan pendientes de respuesta hasta que un administrador las responda. Una vez respondidas, se publican automáticamente para ayudar a otros clientes con dudas similares.<br><br>**RI-104:** Identificador del producto, identificador del usuario que pregunta, texto de la pregunta (máximo 500 caracteres), fecha de la pregunta, estado de respuesta (pendiente/respondida) y fecha de respuesta. |
| **RF-093** | Responder preguntas (Admin) | **Descripción:** El sistema debe permitir a los administradores o vendedores responder las preguntas pendientes de los clientes sobre productos.<br><br>**RN-093:** Los administradores ven todas las preguntas pendientes en un listado. Al responder, la pregunta y respuesta se publican automáticamente en la página del producto. Los clientes que hicieron la pregunta reciben notificación por correo cuando su pregunta es respondida.<br><br>**RI-093:** Identificador de la pregunta, texto de la respuesta (máximo 1000 caracteres), identificador del administrador que responde, fecha de la respuesta, notificación enviada al usuario y publicación automática en página del producto. |
| **RF-094** | Ver reseñas de producto | **Descripción:** El sistema debe permitir visualizar las reseñas y calificaciones de cada producto con estadísticas, promedio y distribución de estrellas.<br><br>**RN-094:** Las reseñas se muestran con estadísticas completas: calificación promedio (1-5 estrellas), total de reseñas y gráfico de distribución. Las reseñas de compras verificadas aparecen primero. Se muestran máximo 10 reseñas por página ordenadas por fecha (más recientes primero) o por utilidad (más votadas primero).<br><br>**RI-094:** Estadísticas de reseñas: calificación promedio, total de reseñas, distribución por estrellas (cuántas de 5★, 4★, 3★, 2★, 1★). Listado de reseñas con: usuario, calificación, título, comentario, fecha, indicador de compra verificada y cantidad de votos útiles. |
| **RF-124** | Sugerencias personalizadas | **Descripción:** El panel del usuario debe mostrar una rejilla de hasta 6 productos sugeridos calculados con base en categorías compatibles, calificaciones positivas y novedades recientes que el cliente aún no tiene en su lista de deseos.<br><br>**RN-124:** El motor ordena primero por calificación promedio y número de reseñas, luego por fecha de lanzamiento. Si no hay suficientes coincidencias, se completa con productos activos al azar. Nunca repite productos ya guardados como favoritos.<br><br>**RI-124:** Datos por producto: id, nombre, slug, categoría, precios (base y promocional), indicador de destacado, ruta de imagen principal, promedio de calificación, número de reseñas, estado favorito y fechas de creación. |

## 4. Proceso de Checkout y Pagos
**Fuente:** `checkout/`, `admin/envio/`, `admin/pagos/`

| ID | Requisito | Detalle (Descripción, Reglas, Datos) |
|---|---|---|
| **RF-043** | Revisar carrito | **Descripción:** El sistema debe mostrar el resumen completo del carrito en el primer paso del proceso de compra, con posibilidad de volver a modificar cantidades.<br><br>**RN-043:** Antes de proceder al pago, puedes revisar tu carrito completo. Todavía puedes modificar cantidades o eliminar productos. Solo los usuarios registrados e iniciados sesión pueden proceder a comprar.<br><br>**RI-043:** Resumen del carrito: listado de productos con cantidades, precios, subtotal, botón para continuar al siguiente paso y validación de usuario autenticado. |
| **RF-044** | Seleccionar dirección | **Descripción:** El sistema debe permitir seleccionar o agregar una dirección de envío de las guardadas, mostrando cada una con mapa y datos completos.<br><br>**RN-044:** Puedes elegir cualquiera de tus direcciones guardadas o agregar una nueva dirección durante el proceso de compra. La dirección debe tener coordenadas GPS obligatorias para que el repartidor pueda ubicarte fácilmente.<br><br>**RI-044:** Listado de direcciones del usuario, dirección seleccionada con: dirección completa, coordenadas GPS, nombre y teléfono del receptor, instrucciones de entrega y visualización en mapa. |
| **RF-045** | Calcular envío | **Descripción:** El sistema debe calcular automáticamente el costo de envío según el subtotal de la compra y las reglas de envío configuradas.<br><br>**RN-045:** El costo de envío varía según el total de tu compra. Compras pequeñas pagan más envío, compras medianas pagan menos, y compras grandes pueden tener envío gratis. El costo se calcula automáticamente al seleccionar la dirección.<br><br>**RI-045:** Subtotal de la compra, reglas de envío aplicables (monto mínimo, monto máximo, costo), costo de envío calculado, días estimados de entrega y total con envío incluido. |
| **RF-046** | Aplicar descuento | **Descripción:** El sistema debe permitir aplicar códigos de descuento válidos, validando su vigencia, usos disponibles y aplicabilidad a los productos del carrito.<br><br>**RN-046:** Puedes ingresar un código de descuento en esta etapa. El sistema verificará que sea válido, que no haya vencido, que no haya alcanzado su límite de usos y que aplique a los productos en tu carrito. Si es válido, verás el descuento reflejado inmediatamente.<br><br>**RI-046:** Código ingresado, validación del código (vigencia, usos, productos), tipo de descuento (porcentaje/monto fijo/envío gratis), valor del descuento, descuento aplicado calculado y nuevo total con descuento. |
| **RF-047** | Tipo de entrega | **Descripción:** El sistema debe mostrar todas las opciones activas de entrega (domicilio, express o recogida en tienda) como tarjetas seleccionables y recalcular al instante el costo y el tiempo de envío según la opción elegida.<br><br>**RN-047:** Los métodos de entrega provienen de la configuración y siempre se marca uno como predeterminado. Si el nombre o la descripción incluyen "tienda" o "recogida", la orden se marca como retiro en tienda, se muestran los datos del punto físico y se genera un enlace directo con la ruta sugerida en Google Maps.<br><br>**RI-047:** Catálogo de métodos activos con: identificador, nombre, descripción, ícono, costo base, tiempo estimado, indicador de recogida en tienda, enlace sugerido, coordenadas del punto físico y dirección de envío seleccionada por el cliente. |
| **RF-048** | Ver resumen final | **Descripción:** El sistema debe mostrar el resumen completo de la compra antes del pago: productos, dirección, envío, descuentos y total final.<br><br>**RN-048:** El resumen final muestra todos los detalles de tu compra claramente desglosados: subtotal de productos, descuento (si aplica), costo de envío y total a pagar. También verás la dirección de entrega y tiempo estimado.<br><br>**RI-048:** Resumen completo: productos con cantidades y precios, dirección de envío, subtotal, descuento aplicado, costo de envío, total final, método de pago seleccionado y botón para confirmar compra. |
| **RF-049** | Procesar pago por transferencia | **Descripción:** El sistema debe permitir realizar el pago mediante transferencia bancaria, mostrando los datos de la cuenta y permitiendo subir el comprobante de pago.<br><br>**RN-049:** Para pagar por transferencia, el sistema te muestra los datos bancarios de la empresa. Después de transferir, debes subir una foto del comprobante (JPG, PNG o PDF, máximo 5 MB). Tu pedido quedará pendiente de verificación hasta que confirmemos el pago.<br><br>**RI-049:** Información bancaria: banco, número de cuenta, tipo de cuenta, titular, identificación. Comprobante subido: archivo, ruta de almacenamiento, fecha de subida. Estado de la transacción: pendiente, verificado o rechazado. |
| **RF-050** | Validar comprobante y consentimiento | **Descripción:** El sistema debe exigir referencia bancaria, comprobante en formatos permitidos y aceptación de términos antes de crear la orden, registrar la transacción y limpiar el carrito.<br><br>**RN-050:** Solo se aceptan comprobantes JPG, PNG o PDF de máximo 5 MB, que se guardan en la carpeta de comprobantes con un nombre único. También se verifica que exista una cuenta bancaria activa y que el cliente marque la casilla de términos; de lo contrario, la compra no continúa.<br><br>**RI-050:** Número de referencia del pago, ruta del comprobante, tipo y tamaño del archivo, marca de aceptación de términos, identificador de la transacción, estado inicial del pago, identificador del descuento utilizado y totales finales (subtotal, envío, total). |
| **RF-051** | Confirmar orden | **Descripción:** El sistema debe crear la orden de compra, enviar correo de confirmación con PDF adjunto, limpiar el carrito y mostrar página de confirmación con número de orden.<br><br>**RN-051:** Al completar tu compra recibirás: 1) Una página de confirmación con tu número de pedido único, 2) Un correo electrónico con todos los detalles y PDF adjunto, 3) Tu carrito se vaciará automáticamente. El stock de los productos se descuenta inmediatamente.<br><br>**RI-051:** Orden creada con: número único de orden (ORD-YYYYMMDD-XXXXXX), identificador del usuario, productos y cantidades, dirección de envío, total, descuento, envío, estado inicial (pendiente), comprobante de pago subido y fecha de creación. |
| **RF-052** | Confirmación inteligente | **Descripción:** La vista de confirmación debe adaptarse según el tipo de entrega, mostrando instrucciones especiales para recogida en tienda, ofreciendo la descarga del PDF y manteniendo visible el número de pedido para futuras consultas.<br><br>**RN-052:** Si la orden es de recogida se muestra mapa con la ruta hacia la tienda, horarios y pasos "Listo para recoger". Para domicilios se despliega la línea de tiempo desde pago hasta entrega. En ambos casos se limpia el carrito, se mantienen descuentos consumidos como usados y solo se permite descargar el PDF si hay motor disponible.<br><br>**RI-052:** Número de orden, correo del cliente, dirección o punto de recogida, coordenadas guardadas, enlace a Google Maps, estados con fecha y hora, indicador `pdf_available`, bandera de limpieza de carrito/descuentos y registro del comprobante generado. |
| **RF-096** | Configurar métodos de envío | **Descripción:** El sistema debe permitir configurar métodos de envío disponibles con nombre, días estimados de entrega y estado activo/inactivo.<br><br>**RN-096:** Los métodos de envío definen las opciones que verán los clientes al comprar (Envío Estándar 3-5 días, Envío Express 1-2 días). Solo los métodos activos aparecen durante el proceso de compra. Cada método tiene días estimados que se muestran al cliente.<br><br>**RI-096:** Nombre del método de envío, descripción breve, días estimados de entrega mínimos, días estimados de entrega máximos, estado (activo/inactivo) y orden de visualización en el checkout. |
| **RF-097** | Configurar reglas de precio de envío | **Descripción:** El sistema debe permitir configurar reglas dinámicas de costo de envío basadas en rangos de precio del subtotal de la compra.<br><br>**RN-097:** Las reglas definen cuánto se cobra de envío según el monto de compra. Por ejemplo: $0-$50,000 = $8,000 envío | $50,001-$100,000 = $5,000 envío | Más de $100,000 = Envío gratis. El sistema aplica automáticamente la regla correspondiente al calcular totales.<br><br>**RI-097:** Precio mínimo del rango, precio máximo del rango (NULL para rango abierto), costo de envío para ese rango, ciudad aplicable (Medellín), método de envío asociado y estado (activa/inactiva). |
| **RF-098** | Registrar cuenta bancaria | **Descripción:** El sistema debe permitir registrar cuentas bancarias de la empresa para recibir transferencias, con información completa del banco y titular.<br><br>**RN-098:** Solo los administradores pueden gestionar las cuentas bancarias. Los datos se almacenan de forma segura y cifrada. Los clientes ven solo las cuentas activas durante el proceso de pago. Siempre debe haber al menos una cuenta activa para recibir pagos.<br><br>**RI-098:** Código del banco (seleccionado de lista de bancos colombianos), número de cuenta (cifrado), tipo de cuenta (ahorros/corriente), titular de la cuenta, tipo de identificación, número de identificación, correo de contacto, teléfono y estado (activa/inactiva). |
| **RF-099** | Mostrar cuentas bancarias | **Descripción:** El sistema debe permitir visualizar el listado completo de cuentas bancarias configuradas con su información y estado.<br><br>**RN-099:** El listado muestra todas las cuentas bancarias con banco, número de cuenta parcialmente oculto (por seguridad), tipo de cuenta, titular, estado y opciones de edición. Las cuentas activas se destacan visualmente. Mínimo debe existir una cuenta activa siempre.<br><br>**RI-099:** Listado de cuentas con: logo del banco, nombre del banco, número de cuenta parcialmente oculto (XXXX-XXXX-1234), tipo de cuenta, titular, estado (activa/inactiva) y opciones de acciones (editar, activar/desactivar). |
| **RF-100** | Actualizar cuenta bancaria | **Descripción:** El sistema debe permitir modificar información de cuentas bancarias existentes o activar/desactivar según necesidades operativas.<br><br>**RN-100:** Puedes actualizar datos de contacto, cambiar el estado de la cuenta o incluso cambiar el número de cuenta. No puedes desactivar la última cuenta activa (debe haber mínimo una). Los cambios en cuentas activas se reflejan inmediatamente en el proceso de pago.<br><br>**RI-100:** Identificador de la cuenta, nuevos valores para: número de cuenta, tipo de cuenta, titular, identificación, contacto, estado, verificación de mínimo una cuenta activa, usuario que modifica y fecha de actualización. |
| **RF-126** | Asistente de Direcciones GPS | **Descripción:** El formulario de direcciones debe ofrecer autocompletado usando OpenStreetMap y permitir convertir coordenadas en direcciones legibles para guardar ubicaciones precisas con un clic.<br><br>**RN-126:** Las búsquedas requieren mínimo dos caracteres, devuelven hasta 5 resultados enfocados en Colombia y muestran barrio, ciudad y coordenadas. El servicio que convierte coordenadas en direcciones valida rangos seguros y guarda la ubicación completa aunque falle el autocompletado.<br><br>**RI-126:** Datos por consulta: texto buscado, lista de resultados (latitud, longitud, nombre mostrado, barrio, ciudad, país), dirección confirmada, coordenadas finales y sello de tiempo para auditoría y control de uso de la API pública. |

## 5. Gestión de Órdenes y Postventa
**Fuente:** `admin/orders.php`, `users/orders.php`

| ID | Requisito | Detalle (Descripción, Reglas, Datos) |
|---|---|---|
| **RF-053** | Listar todas las órdenes | **Descripción:** El sistema debe permitir a los administradores visualizar el listado completo de todas las órdenes con filtros por estado, fecha, cliente y método de pago.<br><br>**RN-053:** Los administradores ven todas las órdenes del sistema ordenadas por fecha (las más recientes primero). Puedes filtrar por: pendientes, pagadas, en preparación, enviadas, entregadas o canceladas. También puedes buscar por número de orden o cliente.<br><br>**RI-053:** Listado de órdenes con: número de orden, fecha, cliente, total, estado del pedido, estado del pago, método de pago y acciones disponibles (ver detalle, editar, cambiar estado, eliminar). |
| **RF-054** | Ver detalle de orden | **Descripción:** El sistema debe permitir ver el detalle completo de cada orden: cliente, productos, dirección, pagos, comprobante subido e historial de estados.<br><br>**RN-054:** El detalle de la orden muestra toda la información: datos del cliente, productos comprados con cantidades y precios, dirección completa con mapa, comprobante de pago (si aplica), historial de cambios de estado con fechas y quién los hizo.<br><br>**RI-054:** Detalle completo: número de orden, información del cliente, productos con variantes, totales desglosados, dirección con coordenadas GPS, comprobante de pago (visualización/descarga), historial de estados con fechas y usuarios responsables. |
| **RF-055** | Cambiar estado de orden | **Descripción:** El sistema debe permitir a los administradores cambiar el estado de las órdenes (pendiente, pagado, en preparación, enviado, entregado, cancelado).<br><br>**RN-055:** Cada cambio de estado queda registrado automáticamente con quién lo hizo y cuándo. Si cambias el estado a "entregado", el sistema registra la fecha de entrega final. Si cancelas, debe indicar el motivo y el stock se reintegra automáticamente.<br><br>**RI-055:** Identificador de la orden, estado anterior, estado nuevo, motivo del cambio (opcional para cancelación), usuario administrador que realiza el cambio, fecha y hora del cambio y registro en historial de estados. |
| **RF-056** | Actualizar estado de pago | **Descripción:** El sistema debe permitir actualizar el estado de pago de las órdenes después de verificar los comprobantes de transferencia.<br><br>**RN-056:** Para órdenes con transferencia bancaria, el administrador debe verificar el comprobante subido y marcar el pago como verificado, rechazado o pendiente. Si se rechaza, debe indicar el motivo para notificar al cliente.<br><br>**RI-056:** Identificador de la orden, estado de pago anterior, nuevo estado de pago (pendiente/verificado/rechazado), motivo (si es rechazo), administrador que verifica, fecha de verificación y notificación automática al cliente. |
| **RF-057** | Eliminar orden | **Descripción:** El sistema debe permitir a los administradores eliminar órdenes individuales después de confirmar la acción.<br><br>**RN-057:** Solo se pueden eliminar órdenes que estén en estado cancelado o rechazado. No puedes eliminar órdenes activas. El sistema pedirá confirmación antes de eliminar. La eliminación queda registrada en auditoría con el motivo.<br><br>**RI-057:** Identificador de la orden, verificación de estado (solo canceladas/rechazadas), motivo de eliminación, usuario administrador que elimina, fecha de eliminación y registro en auditoría. |
| **RF-058** | Eliminar órdenes masivamente | **Descripción:** El sistema debe permitir seleccionar múltiples órdenes y eliminarlas en una sola operación masiva.<br><br>**RN-058:** Puedes seleccionar múltiples órdenes (máximo 100 a la vez) y eliminarlas todas juntas. Solo se eliminarán las que cumplan con los criterios (canceladas/rechazadas). El sistema mostrará un resumen de cuántas se eliminaron exitosamente y cuántas no.<br><br>**RI-058:** Listado de identificadores de órdenes seleccionadas, validación individual de cada una, resultado de la operación (exitosas/fallidas), usuario administrador, motivo masivo y fecha de eliminación masiva. |
| **RF-059** | Ver mis órdenes | **Descripción:** El sistema debe permitir a los usuarios visualizar el historial completo de sus propias órdenes ordenadas por fecha.<br><br>**RN-059:** Puedes ver todas tus compras realizadas ordenadas de la más reciente a la más antigua. Cada orden muestra: número, fecha, productos (cantidad de artículos), total, estado actual y estado de pago. Solo ves tus propias órdenes, no las de otros clientes.<br><br>**RI-059:** Historial de órdenes del usuario con: número de orden, fecha de compra, resumen de productos (cantidad de ítems), total pagado, estado actual, estado de pago y botón para ver detalle. |
| **RF-060** | Ver detalle de mi orden | **Descripción:** El sistema debe permitir a los usuarios ver el detalle completo de cada una de sus órdenes con productos, dirección, pagos y rastreo.<br><br>**RN-060:** En el detalle de tu orden puedes ver: productos comprados con fotos, color y talla, dirección de envío con mapa, totales desglosados (subtotal, descuento, envío, total), comprobante subido (si aplica) e historial de estados con fechas.<br><br>**RI-060:** Detalle de la orden del usuario: número, fecha, productos con imágenes y detalles, dirección completa con visualización en mapa, subtotal, descuento, envío, total, comprobante de pago, historial de estados con línea de tiempo visual. |
| **RF-061** | Rastrear orden en tiempo real | **Descripción:** El sistema debe permitir a los usuarios rastrear el estado de sus órdenes en tiempo real mediante una línea de tiempo visual con cada etapa del proceso.<br><br>**RN-061:** Puedes rastrear tu pedido mediante una línea de tiempo que muestra cada estado con fecha y hora: recibido, pago verificado, en preparación, enviado y entregado. Los estados completados se muestran en verde, el estado actual en azul y los pendientes en gris.<br><br>**RI-061:** Estado actual de la orden, historial completo de estados con fechas y horas, representación visual en línea de tiempo, porcentaje de progreso y tiempo estimado de entrega (si aplica). |
| **RF-062** | Enviar factura tras entrega | **Descripción:** Cuando un administrador marca una orden como entregada, el sistema debe generar la factura en PDF, enviarla por correo electrónico y registrar una notificación para el cliente.<br><br>**RN-062:** El servicio arma la factura con los datos completos de la orden, adjunta el PDF desde facturacion@angelow.com y deja un registro en notificaciones para que el cliente vea que la entrega fue confirmada. Si el correo falla, se escribe en el log y el aviso interno igual se crea.<br><br>**RI-062:** Correo del cliente, nombre del destinatario, número de pedido/factura, lista de productos con imágenes, subtotal, descuentos, envío, total pagado, contenido del PDF, fecha de envío y registro de notificación (tipo, mensaje, entidad relacionada). |
| **RF-063** | Notificar cancelaciones y reembolsos | **Descripción:** Al cancelar un pedido o registrar un reembolso, el sistema debe avisar al cliente por correo, crear notificaciones en la plataforma y dejar trazabilidad del movimiento negativo en las transacciones.<br><br>**RN-063:** Las cancelaciones envían un correo con detalle del pedido, plazos del reembolso y crean una notificación informando el motivo. Los reembolsos generan un registro negativo en payment_transactions con la referencia correspondiente y disparan notificaciones de estado y de pago.<br><br>**RI-063:** Datos de la orden afectada, listado de productos, correo del cliente, monto devuelto, referencia del pago, identificador del administrador, registro negativo en `payment_transactions`, historial de estado actualizado y notificaciones creadas. |
| **RF-113** | Registro automático de cambios | **Descripción:** El sistema debe registrar automáticamente todos los cambios en órdenes: creación, cambio de estado, actualización de pago y eliminación.<br><br>**RN-113:** Cada cambio en órdenes queda registrado permanentemente: qué cambió (estado, pago, dirección), valor anterior, valor nuevo, quién lo hizo (cliente o administrador), desde dónde (dirección IP) y cuándo (fecha y hora exacta). Estos registros no pueden modificarse ni eliminarse, garantizando trazabilidad completa.<br><br>**RI-113:** Registro de auditoría con: identificador de la orden, tipo de cambio (estado/pago/dirección/productos), campo modificado, valor anterior en formato JSON, valor nuevo en formato JSON, usuario ejecutor (ID y nombre), dirección IP, fecha y hora del cambio. |
| **RF-114** | Consulta de auditoría | **Descripción:** El sistema debe permitir a los administradores consultar el historial completo de cambios de cualquier orden para resolución de disputas.<br><br>**RN-114:** Los reportes de auditoría de órdenes son filtrados por: número de orden específico, rango de fechas, tipo de cambio y usuario ejecutor. Sirven para resolver disputas con clientes, identificar errores operativos, análisis de tiempos de procesamiento y cumplimiento con auditorías contables y legales.<br><br>**RI-114:** Historial completo de cambios de la orden con: cronología temporal, tipo de cada acción, usuario responsable, valores antes/después, dirección IP y exportable a PDF para documentación legal o resolución de disputas. |
| **RF-115** | Marcar órdenes como vistas | **Descripción:** El sistema debe registrar automáticamente cuando un administrador visualiza una orden por primera vez para actualizar el contador de órdenes nuevas.<br><br>**RN-115:** Cuando entras a la sección de órdenes, todas las órdenes que aparecen en el listado se marcan automáticamente como vistas por ti. El contador de órdenes nuevas en el menú se actualiza inmediatamente. Cada administrador tiene su propio contador independiente de órdenes no vistas.<br><br>**RI-115:** Registro de visualización con: identificador de la orden, identificador del administrador, fecha y hora de primera visualización, marca de vista única (no se registra si ya fue vista por ese administrador) y actualización del contador del menú. |
| **RF-116** | Mostrar contador de nuevas | **Descripción:** El sistema debe mostrar un contador en el menú de administración indicando cuántas órdenes nuevas aún no han sido visualizadas por el administrador actual.<br><br>**RN-116:** El contador de órdenes nuevas aparece como badge numérico rojo en el menú "Órdenes". Se actualiza en tiempo real cuando entran nuevos pedidos o cuando visualizas las órdenes. Si no hay órdenes nuevas, el badge no se muestra. Cada administrador ve solo su propio contador.<br><br>**RI-116:** Cantidad de órdenes nuevas sin visualizar por el administrador actual, identificador del administrador, actualización en tiempo real del contador, visualización en badge numérico rojo y eliminación del badge cuando el contador llega a cero. |
| **RF-125** | Cancelar pedido en línea | **Descripción:** Desde el historial de pedidos el cliente debe poder cancelar órdenes en estado pendiente o en preparación, recibiendo una confirmación inmediata y el compromiso de gestionar el reembolso por el mismo medio de pago.<br><br>**RN-125:** El servicio valida que la orden pertenezca al usuario y que el estado permita cancelación. Al confirmar, cambia el estado a "cancelado", ajusta el estado de pago a "reembolsado", envía las notificaciones correspondientes y registra la acción en el historial.<br><br>**RI-125:** Información almacenada: id de la orden, usuario solicitante, estado anterior y nuevo, estado de pago resultante, motivo automático, registro de notificación enviada, mensaje mostrado y fecha/hora de la cancelación. |
| **RF-135** | Notificar entrega con factura | **Descripción:** Cuando una orden pasa a "entregada" el sistema debe generar el PDF de la factura, enviarlo por correo y registrar una notificación interna para el cliente sin intervención manual.<br><br>**RN-135:** El proceso arma el paquete completo (datos de cliente, productos, envío), genera el PDF con la plantilla disponible, envía el correo con la factura adjunta y luego crea un registro en el centro de notificaciones ligado a la orden.<br><br>**RI-135:** Información enviada: datos de la orden (cliente, contacto, dirección, método de pago), listado de ítems con imágenes, nombre del archivo PDF, correo destinatario, estado del envío y notificación creada (título, mensaje, referencia del pedido). |
| **RF-136** | Gestionar cancelaciones y reembolsos | **Descripción:** Al cancelar o reembolsar pedidos, el sistema debe crear notificaciones, enviar correos y registrar el movimiento negativo en el historial de pagos para dejar trazabilidad completa.<br><br>**RN-136:** Los procesos de cancelación y reembolso validan que la orden exista, actualizan estados de pago a "reembolsado", crean entradas en el historial de estado, generan correos personalizados y, si no existía, registran un movimiento financiero negativo como evidencia.<br><br>**RI-136:** Datos capturados: id de la orden, usuario afectado, monto reembolsado, referencia del pago, pasarela (si aplica), id del administrador, notificación enviada, correo disparado y movimiento financiero negativo con nota de auditoría. |

## 6. Marketing y Contenido
**Fuente:** `admin/descuento/`, `admin/colecciones/`, `admin/noticias/`, `admin/sliders/`, `admin/announcements/`

| ID | Requisito | Detalle (Descripción, Reglas, Datos) |
|---|---|---|
| **RF-064** | Crear código de descuento | **Descripción:** El sistema debe permitir a los administradores crear códigos de descuento personalizados con tipo (porcentaje, monto fijo, envío gratis), valor, vigencia y límite de usos.<br><br>**RN-064:** Los códigos de descuento deben tener fecha de inicio y fin. Puedes configurar cuántas veces se puede usar en total y si es de un solo uso por cliente. Los códigos se pueden aplicar a todos los productos o solo a categorías/productos específicos.<br><br>**RI-064:** Código único alfanumérico, tipo de descuento (porcentaje/monto fijo/envío gratis), valor del descuento, fecha de inicio de vigencia, fecha de fin de vigencia, límite total de usos, indicador de un solo uso por cliente, productos o categorías aplicables y estado activo/inactivo. |
| **RF-065** | Mostrar códigos de descuento | **Descripción:** El sistema debe permitir visualizar el listado completo de códigos de descuento con su información, usos restantes y estado de vigencia.<br><br>**RN-065:** El listado muestra todos los códigos: activos, próximos a vencer (en los próximos 7 días con alerta amarilla), vencidos y agotados. Puedes ver cuántas veces se ha usado cada código y cuántos usos quedan disponibles.<br><br>**RI-065:** Listado de códigos con: código, tipo de descuento, valor, fecha de inicio y fin de vigencia, total de usos permitidos, usos realizados, usos restantes, indicadores visuales (próximo a vencer, vencido, agotado) y opciones de acciones (editar, activar/desactivar, eliminar). |
| **RF-066** | Generar códigos masivamente | **Descripción:** El sistema debe permitir generar múltiples códigos de descuento únicos en una sola operación con un prefijo común y numeración automática.<br><br>**RN-066:** Puedes generar hasta 1000 códigos a la vez con un formato como "VERANO2025-001", "VERANO2025-002", etc. Todos los códigos generados comparten el mismo tipo de descuento, valor, vigencia y límite de usos. Es útil para campañas masivas.<br><br>**RI-066:** Prefijo común para los códigos, cantidad de códigos a generar (1-1000), numeración inicial, tipo de descuento, valor, fecha de vigencia, límite de usos, estado inicial y resultado de la generación (códigos creados exitosamente). |
| **RF-067** | Asignar código a usuario | **Descripción:** El sistema debe permitir asignar códigos de descuento personalizados a usuarios específicos, enviándoles automáticamente un correo con el código.<br><br>**RN-067:** Cuando asignas un código personalizado a un cliente, este recibe automáticamente un correo profesional con el código destacado, explicación del beneficio, fecha de vencimiento, instrucciones de uso y botón directo para ir a la tienda.<br><br>**RI-067:** Identificador del código de descuento, identificador del usuario destinatario, fecha de asignación, correo electrónico de notificación enviado (asunto, cuerpo, estado de envío) y fecha de expiración del código asignado. |
| **RF-068** | Crear regla de descuento bulk | **Descripción:** El sistema debe permitir crear reglas de descuento automático basadas en cantidad de productos comprados (por ejemplo: 10% al comprar 5 o más unidades).<br><br>**RN-068:** Las reglas de descuento por cantidad se aplican automáticamente al carrito cuando se cumple el mínimo de productos. Puedes configurar rangos como "5-9 unidades: 10% descuento" y "10+ unidades: 15% descuento". No se combinan con códigos promocionales.<br><br>**RI-068:** Cantidad mínima de productos, cantidad máxima (opcional para rango abierto), porcentaje de descuento a aplicar, categorías o productos aplicables, fechas de vigencia de la regla y estado activo/inactivo. |
| **RF-069** | Mostrar reglas bulk | **Descripción:** El sistema debe permitir visualizar todas las reglas de descuento por cantidad configuradas con su información de aplicabilidad y estado.<br><br>**RN-069:** El listado muestra cada regla con su rango de cantidad, porcentaje de descuento, productos/categorías donde aplica, vigencia y estado. Las reglas activas se destacan y se muestran primero en el listado.<br><br>**RI-069:** Listado de reglas con: rango de cantidad (mínimo-máximo), porcentaje de descuento, aplicabilidad (todos los productos, categoría específica, productos específicos), fecha de vigencia, estado activo/inactivo y opciones de editar/eliminar. |
| **RF-070** | Aplicación automática en carrito | **Descripción:** El sistema debe aplicar automáticamente el descuento por cantidad cuando el carrito cumple con las condiciones de alguna regla activa.<br><br>**RN-070:** Cuando agregas suficientes productos al carrito para calificar a un descuento por cantidad, este se aplica automáticamente sin necesidad de código. Si calificas para varios descuentos (código + bulk), se aplica el que te genere mayor ahorro.<br><br>**RI-070:** Cantidad total de productos en el carrito, reglas aplicables evaluadas, mejor descuento identificado, cálculo del descuento aplicado, nuevo subtotal con descuento y mensaje informativo al usuario sobre el descuento aplicado. |
| **RF-078** | Crear colección | **Descripción:** El sistema debe permitir a los administradores crear colecciones temáticas de productos con nombre, descripción, imagen destacada y fecha de lanzamiento.<br><br>**RN-078:** Las colecciones son agrupaciones temáticas de productos para campañas de marketing (como "Verano 2025", "Línea Premium", "Vuelta al Cole"). Cada colección tiene URL amigable generada automáticamente. Un producto puede estar en varias colecciones simultáneamente.<br><br>**RI-078:** Nombre de la colección, identificador de URL amigable (slug) generado automáticamente, descripción de la colección, imagen destacada (JPG/PNG máximo 2MB), fecha de lanzamiento, estado (activa/inactiva) y fecha de creación. |
| **RF-079** | Mostrar colecciones | **Descripción:** El sistema debe permitir visualizar el listado completo de colecciones con cantidad de productos asociados y estado de cada una.<br><br>**RN-079:** El listado muestra todas las colecciones con su imagen, nombre, descripción resumida, fecha de lanzamiento, cantidad de productos asociados y estado. Puedes ver, editar o eliminar cada colección. Las colecciones activas aparecen en la tienda.<br><br>**RI-079:** Listado de colecciones con: identificador, nombre, imagen miniatura, cantidad de productos asociados, fecha de lanzamiento, estado (activa/próximamente/inactiva) y opciones de acciones (editar, gestionar productos, eliminar). |
| **RF-080** | Actualizar colección | **Descripción:** El sistema debe permitir modificar cualquier información de colecciones existentes: nombre, descripción, imagen, fecha de lanzamiento o agregar/quitar productos.<br><br>**RN-080:** Al editar una colección puedes cambiar su información básica y gestionar qué productos la integran. Los productos se agregan desde una lista donde puedes buscar y seleccionar múltiples productos a la vez. Los cambios se reflejan inmediatamente en la tienda.<br><br>**RI-080:** Identificador de la colección, nuevos valores para: nombre, descripción, imagen, fecha de lanzamiento, estado, productos asociados (agregar/eliminar), usuario administrador que modifica y fecha de última actualización. |
| **RF-081** | Eliminar colección | **Descripción:** El sistema debe permitir eliminar colecciones que ya no se utilizan, liberando espacio y simplificando el catálogo.<br><br>**RN-081:** Al eliminar una colección se borran solo las relaciones con productos, no los productos en sí. Los productos quedan disponibles normalmente en el catálogo. El sistema pedirá confirmación antes de eliminar. La eliminación queda registrada en auditoría.<br><br>**RI-081:** Identificador de la colección a eliminar, cantidad de productos asociados, confirmación de eliminación, imagen eliminada, usuario administrador que elimina y fecha de eliminación para auditoría. |
| **RF-082** | Crear noticia | **Descripción:** El sistema debe permitir a los administradores crear artículos de noticias o blog con título, contenido, imagen destacada y fecha de publicación.<br><br>**RN-082:** Las noticias pueden programarse para publicarse automáticamente en fecha futura. Puedes marcarlas como destacadas para aparecer en posición preferencial. El contenido admite formato enriquecido (negritas, cursivas, listas, enlaces). Cada noticia tiene URL amigable generada del título.<br><br>**RI-082:** Título de la noticia, identificador de URL (slug) generado automáticamente, contenido completo en formato enriquecido, imagen destacada, fecha de publicación, indicador de noticia destacada, estado (publicada/borrador) y autor (administrador). |
| **RF-083** | Mostrar noticias | **Descripción:** El sistema debe permitir visualizar el listado completo de noticias publicadas ordenadas por fecha, con filtros por estado y búsqueda por título.<br><br>**RN-083:** El listado muestra todas las noticias con imagen, título, extracto, fecha de publicación, autor, estado y indicador de destacada. Puedes filtrar por publicadas, borradores o todas. Las noticias destacadas aparecen con icono especial.<br><br>**RI-083:** Listado de noticias con: imagen miniatura, título, extracto del contenido (primeros 150 caracteres), autor, fecha de publicación, estado (publicada/borrador), indicador de destacada y opciones de acciones (ver, editar, eliminar). |
| **RF-084** | Actualizar noticia | **Descripción:** El sistema debe permitir modificar cualquier información de noticias existentes: título, contenido, imagen, fecha de publicación, estado destacado.<br><br>**RN-084:** Al editar una noticia puedes cambiar todo su contenido y configuración. Si cambias el título, la URL amigable se regenera automáticamente. Puedes convertir borradores en publicadas y viceversa. Los cambios son inmediatos en la sección de noticias de la tienda.<br><br>**RI-084:** Identificador de la noticia, nuevos valores para: título, contenido, imagen, fecha de publicación, estado destacado, estado de publicación, usuario que modifica y fecha de última actualización. |
| **RF-085** | Eliminar noticia | **Descripción:** El sistema debe permitir eliminar noticias obsoletas o que contienen información incorrecta, con confirmación previa.<br><br>**RN-085:** Al eliminar una noticia se borra completamente su contenido e imagen asociada. El sistema pedirá confirmación antes de eliminar. La eliminación queda registrada en auditoría con quién la eliminó y cuándo.<br><br>**RI-085:** Identificador de la noticia a eliminar, título y fecha de publicación (para confirmación), imagen eliminada, usuario administrador que elimina, motivo de eliminación (opcional) y fecha de eliminación. |
| **RF-086** | Crear slider | **Descripción:** El sistema debe permitir crear banners deslizantes para la página principal con imagen, título, subtítulo, enlace de redirección y orden de visualización.<br><br>**RN-086:** Los sliders son banners promocionales grandes que aparecen rotativamente en la página de inicio. Cada uno puede enlazar a una categoría, colección, producto o URL externa. El orden determina la secuencia de rotación. Las imágenes deben ser de alta calidad (1920x600px recomendado).<br><br>**RI-086:** Título del banner, subtítulo descriptivo, imagen de fondo (JPG/PNG máximo 3MB), URL de redirección al hacer clic, orden de visualización numérico, estado (activo/inactivo) y fecha de creación. |
| **RF-087** | Mostrar sliders | **Descripción:** El sistema debe permitir visualizar el listado completo de sliders con su imagen, texto, enlace, orden y estado.<br><br>**RN-087:** El listado muestra todos los sliders ordenados según su número de orden. Los activos se destacan visualmente. Puedes reordenarlos arrastrando, editar su contenido o activar/desactivar individualmente. Solo los sliders activos aparecen en la página principal.<br><br>**RI-087:** Listado de sliders con: imagen miniatura, título, subtítulo, enlace de redirección, orden de visualización, estado (activo/inactivo), indicador de slider actualmente visible y opciones de acciones (ver preview, editar, cambiar orden, eliminar). |
| **RF-088** | Actualizar slider | **Descripción:** El sistema debe permitir modificar cualquier información de sliders existentes: imagen, títulos, enlace, orden o estado.<br><br>**RN-088:** Al editar un slider puedes cambiar su imagen, textos, enlace de destino, orden de aparición y activarlo o desactivarlo. Los cambios son inmediatos en la página principal. Puedes previsualizar cómo se verá antes de guardar los cambios.<br><br>**RI-088:** Identificador del slider, nuevos valores para: título, subtítulo, imagen, URL de redirección, orden, estado, usuario administrador que modifica y fecha de última actualización. |
| **RF-089** | Eliminar slider | **Descripción:** El sistema debe permitir eliminar sliders que ya no se utilizan en las campañas promocionales actuales.<br><br>**RN-089:** Al eliminar un slider se borra su imagen y configuración completamente. El sistema reordena automáticamente los sliders restantes para evitar huecos en la numeración. Pedirá confirmación antes de eliminar permanentemente.<br><br>**RI-089:** Identificador del slider a eliminar, imagen eliminada, orden liberado, reordenamiento automático de sliders restantes, usuario que elimina y fecha de eliminación. |
| **RF-117** | Crear anuncio promocional | **Descripción:** El sistema debe permitir registrar anuncios con tipo (barra superior o banner), título, mensaje, icono profesional, prioridad, fechas de publicación y opciones visuales como subtítulo, botón y carga de imagen.<br><br>**RN-117:** Solo se permiten dos anuncios activos en simultáneo para mantener el sitio limpio. Se valida que el icono sea obligatorio, la imagen pese máximo 3 MB (JPG, PNG o WEBP) y que las fechas de inicio/fin estén en orden antes de guardar.<br><br>**RI-117:** Campos obligatorios: tipo, título, mensaje, icono, prioridad, estado, usuario creador, fecha de creación. Campos opcionales: subtítulo, texto y enlace del botón, imagen subida, fecha inicio/fin y color de fondo. |
| **RF-118** | Gestionar anuncios publicados | **Descripción:** El panel de administración debe mostrar una cuadrícula con todos los anuncios creados, indicando tipo, estado, prioridad, fechas de vigencia y accesos directos para editar o eliminar cada registro.<br><br>**RN-118:** La grilla se actualiza en tiempo real y oculta el botón "Agregar anuncio" cuando ya existen dos registros. Cada tarjeta incluye distintivos de tipo (barra o banner), estado activo/inactivo, prioridad y fecha de creación para tomar decisiones rápidas.<br><br>**RI-118:** Listado con: identificador, tipo, título, mensaje resumido, prioridad, estado actual, fecha de creación, fecha de inicio/fin, miniatura de imagen (si existe) y enlace para edición o eliminación segura. |
| **RF-119** | Barra superior en tienda | **Descripción:** La tienda debe mostrar automáticamente en la parte superior el anuncio de tipo "barra" con mayor prioridad que esté activo y dentro de la ventana de fechas, incluyendo icono y colores corporativos.<br><br>**RN-119:** Solo se pinta un anuncio a la vez. Si el anuncio expira, se desactiva o se programa para el futuro, la barra desaparece sin intervención manual. El mensaje se obtiene en cada carga de página para asegurarse de que siempre esté actualizado.<br><br>**RI-119:** Datos de renderizado: título corto, mensaje, icono FontAwesome seleccionado, color de fondo/texto, prioridad, estado, fecha de inicio/fin y enlace (si aplica) para convertir el mensaje en botón. |
| **RF-120** | Banner promocional destacado | **Descripción:** La página principal debe mostrar un banner promocional con imagen, subtítulo, texto y botón cuando exista un anuncio de tipo "promo" activo con prioridad más alta.<br><br>**RN-120:** Si el anuncio incluye imagen se usa el archivo subido; de lo contrario se muestra un fondo degradado estándar. El botón solo aparece cuando hay texto y enlace configurados. Fuera de la vigencia el banner se oculta automáticamente.<br><br>**RI-120:** Información requerida: identificador del anuncio, subtítulo, texto principal, ruta de la imagen optimizada, texto del botón, enlace, prioridad, estado y marcas de tiempo para auditoría. |
| **RF-107** | Correo de bienvenida | **Descripción:** El sistema debe enviar automáticamente un correo de bienvenida cuando un nuevo usuario se registra en la plataforma.<br><br>**RN-107:** Al registrarte recibes inmediatamente un correo de bienvenida con: saludo personalizado con tu nombre, mensaje de bienvenida a la tienda, enlaces rápidos a secciones principales (productos, colecciones) y datos de contacto para soporte. El correo usa diseño profesional con logo de la empresa.<br><br>**RI-107:** Plantilla de correo de bienvenida con: nombre del usuario, correo electrónico de destino, mensaje personalizado, enlaces a la tienda, logo de la empresa, datos de contacto y pie de página con redes sociales. |
| **RF-108** | Correo de confirmación de orden | **Descripción:** El sistema debe enviar correo de confirmación inmediatamente después de completar una compra con PDF adjunto de la factura.<br><br>**RN-108:** Al completar tu compra recibes automáticamente un correo con: número de orden único, resumen de productos comprados, dirección de entrega, totales desglosados, instrucciones de pago (si aplica), enlace para rastrear tu pedido y PDF adjunto con factura completa. El correo es profesional con diseño corporativo.<br><br>**RI-108:** Plantilla de correo con: número de orden, datos del cliente, productos con imágenes, dirección de envío, subtotal, descuento, envío, total, método de pago, estado del pago, enlace de rastreo y documento PDF adjunto con factura. |
| **RF-109** | Correo de cambio de estado | **Descripción:** El sistema debe enviar notificaciones automáticas por correo cuando el estado de una orden cambia (pagado, en preparación, enviado, entregado).<br><br>**RN-109:** Cada vez que tu pedido cambia de estado recibes un correo informativo: "Tu pago fue verificado", "Tu pedido está en preparación", "Tu pedido fue enviado", "Tu pedido fue entregado". Cada correo incluye el nuevo estado, fecha y hora del cambio, número de orden y enlace para ver detalles.<br><br>**RI-109:** Plantilla de correo con: número de orden, nombre del cliente, estado anterior, estado nuevo, fecha y hora del cambio, mensaje descriptivo del nuevo estado, próximos pasos esperados y enlace para rastrear la orden. |

## 7. Administración y Reportes
**Fuente:** `admin/dashboardadmin.php`, `admin/admins/`, `admin/reports/`

| ID | Requisito | Detalle (Descripción, Reglas, Datos) |
|---|---|---|
| **RF-127** | Registrar administrador | **Descripción:** El panel debe permitir crear cuentas administrativas ingresando nombre, correo corporativo, contraseña temporal y rol, para delegar tareas sin exponer usuarios personales.<br><br>**RN-127:** Solo los administradores autenticados pueden crear nuevos perfiles. El correo debe ser único y la contraseña se almacena en forma cifrada. Tras guardar se redirige automáticamente al listado general.<br><br>**RI-127:** Datos almacenados: nombre, correo, contraseña cifrada, rol asignado, fecha de creación, usuario que realizó el alta y estado inicial (activo). |
| **RF-128** | Listar equipo administrativo | **Descripción:** Debe mostrarse una tabla dinámica con todos los administradores, indicando nombre, correo, rol, estado (activo/bloqueado) y un resumen estadístico del equipo.<br><br>**RN-128:** La tabla se alimenta automáticamente, ordena por último acceso y ofrece filtros por estado. Incluye contadores de totales, activos, bloqueados y últimos ingresos de la semana.<br><br>**RI-128:** Por cada registro: id, nombre, correo, teléfono, avatar, rol, estado bloqueado, fecha de creación y fecha del último acceso; además, métricas agregadas para las tarjetas de resumen. |
| **RF-129** | Bloquear o reactivar | **Descripción:** Desde la tabla el supervisor debe poder bloquear o reactivar administradores con un clic para controlar accesos de manera inmediata.<br><br>**RN-129:** Cada botón solicita confirmación y ejecuta la acción solicitada de inmediato. Solo se permiten acciones sobre cuentas con rol admin; el servicio verifica existencia y responde con el estado actualizado.<br><br>**RI-129:** Parámetros: identificador del usuario, acción solicitada (block/unblock), usuario que ejecuta, sello de tiempo y respuesta con el registro completo para refrescar la fila en pantalla. |
| **RF-130** | Editar perfil / reset clave | **Descripción:** El sistema debe permitir editar datos de contacto del administrador y generar contraseñas temporales cuando sea necesario restaurar accesos seguros.<br><br>**RN-130:** Se valida que el correo siga siendo único, el teléfono sea opcional y que la nueva contraseña temporal se genere aleatoriamente (10 caracteres alfanuméricos) y se muestre una sola vez al supervisor.<br><br>**RI-130:** Información registrada: id del administrador, nombre, correo, teléfono, ruta de imagen, estado bloqueado, contraseña cifrada (si aplica) y bitácora de quién realizó la edición. |
| **RF-DASH-001** | Métricas principales | **Descripción:** El sistema debe mostrar en el dashboard principal las métricas clave del negocio: ventas del día/mes, órdenes pendientes, productos con stock bajo y nuevos clientes.<br><br>**RN-104:** El dashboard es la primera página que ve el administrador al iniciar sesión. Muestra tarjetas con números grandes para visualización rápida: ventas de hoy, ventas del mes, órdenes pendientes de procesar, alertas de inventario bajo, nuevos clientes del mes y comparativas con períodos anteriores.<br><br>**RI-104:** Ventas del día (monto y cantidad), ventas del mes (monto y cantidad), órdenes pendientes (cantidad), productos con stock crítico (cantidad), nuevos clientes del mes (cantidad) y porcentaje de cambio vs período anterior para cada métrica. |
| **RF-DASH-002** | Alertas y notificaciones | **Descripción:** El sistema debe mostrar alertas importantes en el dashboard: órdenes nuevas sin ver, productos agotados, códigos de descuento próximos a vencer y pagos pendientes de verificar.<br><br>**RN-105:** Las alertas se destacan con colores según prioridad: rojo para críticas (pagos por verificar), amarillo para advertencias (stock bajo) y azul para información (nuevas órdenes). Cada alerta es clickeable y lleva directamente a la sección correspondiente para tomar acción.<br><br>**RI-105:** Contador de órdenes nuevas sin visualizar, cantidad de productos agotados, códigos de descuento que vencen en próximos 7 días (cantidad), pagos por transferencia pendientes de verificación (cantidad y monto) y alertas de stock bajo (cantidad de productos). |
| **RF-DASH-003** | Gráficos de tendencias | **Descripción:** El sistema debe mostrar gráficos interactivos de tendencias: ventas de últimos 30 días, productos más vendidos, categorías más populares y registros de clientes.<br><br>**RN-106:** Los gráficos son interactivos: puedes pasar el cursor sobre puntos específicos para ver valores exactos. Los períodos se pueden ajustar (7 días, 30 días, 3 meses, año). Los gráficos se actualizan en tiempo real al seleccionar diferentes períodos de tiempo.<br><br>**RI-106:** Datos para gráfico de líneas de ventas (fecha, monto), datos para gráfico de barras de productos más vendidos (producto, cantidad), datos para gráfico de torta de categorías (categoría, porcentaje) y datos de registro de clientes por período (fecha, cantidad). |
| **RF-131** | Búsqueda global | **Descripción:** El encabezado del panel debe ofrecer una búsqueda global que encuentre órdenes, productos, clientes y atajos de navegación con resultados instantáneos.<br><br>**RN-131:** La búsqueda requiere mínimo dos caracteres, limita la respuesta a 5 resultados por categoría y solo está disponible para usuarios con rol admin. Cada resultado muestra título, detalle y enlace directo a la sección correspondiente.<br><br>**RI-131:** Respuesta organizada en cuatro grupos (órdenes, productos, clientes y atajos) con: id, título, subtítulo, enlace destino y categoría para resaltar iconos e interpretar teclas rápidas. |
| **RF-132** | Acciones rápidas | **Descripción:** El botón de acciones rápidas debe mostrar accesos directos configurables (nuevo producto, generar cupones, revisar pagos, etc.) para iniciar tareas frecuentes sin navegar por el menú completo.<br><br>**RN-132:** Las acciones se definen en una configuración central, cada una con identificador, icono, descripción y ruta dentro del panel. La lista se usa también por la búsqueda global para mantener coherencia.<br><br>**RI-132:** Configuración por acción: identificador, etiqueta, descripción, icono predefinido, ruta relativa, palabras clave para búsqueda y categoría (acción o módulo) para ordenar la visualización. |
| **RF-REP-001** | Informe de clientes | **Descripción:** El sistema debe generar informes de clientes con estadísticas: total registrados, clientes con compras, clientes sin compras, cliente con mayor gasto.<br><br>**RN-101:** El informe de clientes muestra métricas del negocio: cuántos clientes están registrados, cuántos han comprado al menos una vez, cuántos nunca han comprado, quién es el cliente que más ha gastado y el valor promedio de compra por cliente. Puedes filtrar por período de tiempo.<br><br>**RI-101:** Total de clientes registrados, clientes con órdenes completadas, clientes sin compras, cliente con mayor gasto total (nombre y monto), valor promedio de compra, tasa de conversión (porcentaje que ha comprado) y gráfico de tendencia de registro. |
| **RF-REP-002** | Informe de productos | **Descripción:** El sistema debe generar informes de productos con: productos más vendidos, productos con stock bajo, productos sin ventas y valor total de inventario.<br><br>**RN-102:** El informe de productos ayuda a tomar decisiones de inventario: identifica top 10 productos más vendidos, productos con stock crítico (bajo el umbral), productos que no se han vendido nunca, valor total del inventario y productos próximos a agotarse. Incluye gráficos de barras para visualización clara.<br><br>**RI-102:** Top 10 productos más vendidos (nombre, cantidad vendida, ingresos generados), productos con stock crítico (nombre, stock actual, umbral), productos sin ventas, valor total del inventario (suma de precio×stock) y alertas de reabastecimiento. |
| **RF-REP-003** | Informe de ventas | **Descripción:** El sistema debe generar informes de ventas con: ingresos totales, cantidad de órdenes, ticket promedio, comparativa con período anterior y gráficos de tendencias.<br><br>**RN-103:** El informe de ventas muestra la salud financiera del negocio: ingresos totales del período, cantidad de pedidos, ticket promedio (valor promedio por orden), comparativa con mes/año anterior (porcentaje de crecimiento), ingresos por día/semana/mes y gráfico de líneas de tendencia.<br><br>**RI-103:** Ingresos totales del período, cantidad de órdenes completadas, ticket promedio, comparativa con período anterior (porcentaje de cambio), ingresos por día/semana/mes (gráfico), método de pago más usado y descuentos aplicados totales. |
| **RF-110** | Exportar órdenes a PDF | **Descripción:** El sistema debe permitir generar documentos PDF profesionales de órdenes individuales o múltiples con formato de factura.<br><br>**RN-110:** Los PDF de órdenes se generan con diseño profesional: logo de la empresa, información corporativa (NIT, dirección), datos completos del cliente, productos con imágenes, totales desglosados, método de pago, código de verificación QR y términos y condiciones. Cumple con requisitos legales de facturación.<br><br>**RI-110:** Documento PDF con: encabezado corporativo (logo, datos empresa), número de orden, fecha, información del cliente, dirección de envío, tabla de productos con cantidades y precios, subtotal, descuentos, envío, total, método de pago, código QR y pie de página legal. |
| **RF-111** | Exportar productos a CSV | **Descripción:** El sistema debe permitir exportar el catálogo completo de productos a formato CSV respetando filtros aplicados.<br><br>**RN-111:** El archivo CSV contiene toda la información del catálogo: identificador, nombre, descripción, categoría, género, precio, variantes de color, variantes de talla, stock total, estado y fecha de creación. Usa punto y coma como separador y encabezados en español. Compatible con Excel, Google Sheets y sistemas empresariales.<br><br>**RI-111:** Archivo CSV con columnas: ID, Nombre, Descripción, Categoría, Género, Precio, Colores Disponibles, Tallas Disponibles, Stock Total, Estado, Fecha Creación. Delimitador punto y coma, codificación UTF-8 con BOM para caracteres especiales. |
| **RF-112** | Exportar clientes a Excel | **Descripción:** El sistema debe permitir exportar el listado de clientes a formato Excel con información de contacto y estadísticas de compras.<br><br>**RN-112:** El archivo Excel de clientes incluye: nombre, correo, teléfono, fecha de registro, cantidad de órdenes realizadas, total gastado, fecha de última compra y estado de la cuenta. Los datos personales están protegidos y solo administradores pueden exportarlos. Útil para campañas de marketing y análisis CRM.<br><br>**RI-112:** Archivo Excel con columnas: ID Cliente, Nombre Completo, Correo Electrónico, Teléfono, Fecha Registro, Total Órdenes, Total Gastado, Fecha Última Compra, Estado Cuenta. Formato XLSX compatible con Excel 2010 y posteriores. |
| **RF-133** | Diagnóstico de exportación PDF | **Descripción:** El panel debe incluir una página de diagnóstico que verifique versión de PHP, dependencias Composer, sesión activa, conexión a base de datos, permisos de carpetas y disponibilidad de librerías TCPDF/Dompdf.<br><br>**RN-133:** Si falta la instalación de bibliotecas se muestra la instrucción para completarla desde consola. También se prueba la generación real de PDFs con las dos librerías y se registran advertencias cuando el servidor carece de extensiones necesarias.<br><br>**RI-133:** Reporte con: versión de PHP, existencia de archivos clave, estado de extensiones, datos de sesión, conteo de órdenes en la base de datos, rutas de logotipos, permisos de carpetas temporales y resultado de pruebas de PDF. |
| **RF-134** | Inspección de tablas | **Descripción:** Debe existir una herramienta que liste todas las tablas de la base de datos con su cantidad de registros y muestre detalles de aquellas relacionadas con productos y pedidos para diagnósticos rápidos.<br><br>**RN-134:** El informe resalta tablas relacionadas con productos y pedidos, describe los campos principales de los artículos vendidos y presenta un ejemplo de registro. Si falta alguna tabla clave se marca en rojo para facilitar la corrección.<br><br>**RI-134:** Información presentada: nombre de la tabla, número de filas, lista resumida de columnas, ejemplo de datos (cuando aplica) y mensajes de éxito/alerta para guiar al personal técnico. |
| **RF-121** | Bandeja de notificaciones | **Descripción:** Los usuarios deben contar con una bandeja donde consulten hasta 50 notificaciones recientes con filtros por estado (todas, leídas, sin leer) y por tipo (pedidos, productos, promociones, sistema o cuenta).<br><br>**RN-121:** Al ingresar se marcan automáticamente como leídas para evitar duplicar alertas. Cada tarjeta muestra icono contextual, título, mensaje, tiempo transcurrido y, cuando aplica, un enlace directo al pedido relacionado.<br><br>**RI-121:** Notificación con: id, usuario, título, mensaje, tipo, entidad relacionada, fecha de creación, indicador leído/no leído, fecha de lectura y enlace opcional para abrir el detalle que generó la alerta. |
| **RF-122** | Contador en tiempo real | **Descripción:** El encabezado del sitio debe mostrar un contador dinámico de notificaciones pendientes alimentado por consultas automáticas y actualizarlo periódicamente sin recargar la página.<br><br>**RN-122:** El contador solo aparece para usuarios autenticados, toma en cuenta las preferencias del usuario y se actualiza cada pocos minutos o cuando el usuario elimina o lee una notificación.<br><br>**RI-122:** Respuesta JSON con: identificador del usuario, cantidad total de notificaciones sin leer, hora de cálculo y bandera de éxito para manejar errores o sesiones caducadas en el front. |
| **RF-123** | Acciones sobre notificaciones | **Descripción:** El usuario debe poder eliminar notificaciones individuales, marcar todas como leídas en un clic y disparar acciones según el tipo (por ejemplo, abrir el pedido en seguimiento) sin abandonar la página.<br><br>**RN-123:** Cada acción se valida contra el usuario autenticado para evitar manipulaciones. Las operaciones muestran mensajes claros y actualizan de inmediato la bandeja y los contadores.<br><br>**RI-123:** Parámetros: id de notificación, usuario propietario, acción solicitada (leer, eliminar, leer todas), fecha/hora aplicada y respuesta del sistema para refrescar los contadores y el listado en pantalla. |


