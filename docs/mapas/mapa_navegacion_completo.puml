@startuml Mapa de Navegación Completo - Angelow
skinparam componentStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam component {
    BackgroundColor #FFFFFF
    BorderColor #333333
    BorderThickness 2
}

title Mapa de Navegación Completo - Sistema Angelow

' ===== USUARIO PÚBLICO / TIENDA =====
package "Tienda Online (Frontend Público)" as Tienda {
    component "Inicio" as Inicio
    component "Catálogo Global" as Catalogo
    component "Detalle Producto" as DetalleProducto
    component "Buscador y Guardados" as Busqueda
    component "Carrito - Paso 1" as CheckoutPaso1
    component "Paso de Envío" as CheckoutPaso2
    component "Pago y Comprobantes" as CheckoutPaso3
    component "Confirmación" as Confirmacion
    component "Lista de Deseos Rápida" as WishlistPublic
    component "Alertas Promocionales" as AlertasFront
}

' ===== AUTENTICACIÓN =====
package "Sistema de Autenticación" as Auth {
    component "Login" as Login
    component "Registro" as Registro
    component "Google OAuth" as GoogleAuth
    component "Middleware Roles" as Middleware
    component "Redirección Roles" as RoleRedirect
    component "Logout" as Logout
}

' ===== PANEL DE USUARIO =====
package "Panel de Usuario" as UserPanel {
    component "Dashboard Usuario" as UserDashboard
    component "Perfil y Seguridad" as UserPerfil
    component "Mis Órdenes" as UserOrders
    component "Detalle Orden" as UserOrderDetail
    component "Comprobantes" as UserInvoice
    component "Direcciones con GPS" as UserAddresses
    component "Lista de Deseos Usuario" as UserWishlist
    component "Alertas Personalizadas" as UserAlerts
    component "Notificaciones" as UserNotifications
    component "Acciones AJAX" as UserAjax
}

' ===== PANEL DE ADMINISTRACIÓN =====
package "Panel de Administración" as AdminPanel {
    component "Dashboard Admin" as AdminDashboard

    package "Catálogo y Contenido" as AdminCatalogo {
        component "Productos" as AdminProductsList
        component "Nuevo Producto" as AdminAddProduct
        component "Edición Producto" as AdminEditProduct
        component "Categorías" as AdminCategories
        component "Colecciones" as AdminCollections
        component "Tallas" as AdminSizes
        component "Inventario" as AdminInventory
        component "Sliders" as AdminSliders
        component "Anuncios" as AdminAnnouncements
    }

    package "Ventas y Operaciones" as AdminSales {
        component "Órdenes" as AdminOrders
        component "Gestión de Órdenes" as AdminOrderTools
        component "Pagos" as AdminPayments
        component "Reglas de Envío" as AdminShipping
        component "Descuentos Masivos" as AdminDiscounts
        component "Reportes Ventas" as AdminSalesReport
        component "Reportes Productos" as AdminProductReport
        component "Reportes Clientes" as AdminClientReport
    }

    package "Personas y Configuración" as AdminPeople {
        component "Clientes" as AdminClients
        component "Administradores" as AdminAdmins
        component "Perfiles Admin" as AdminProfiles
        component "Ajustes Generales" as AdminSettings
        component "Reseñas y Preguntas" as AdminReviews
    }
}

' ===== CAPA AJAX / APIS INTERNAS =====
package "Capa AJAX y APIs" as InternalAPIs {
    component "AJAX Admin" as AjaxAdmin
    component "AJAX Busquedas" as AjaxSearch
    component "AJAX Carrito" as AjaxCart
    component "AJAX Lista de Deseos" as AjaxWishlist
    component "APIs Tienda - Carrito" as ApiCart
    component "APIs Tienda - Pago" as ApiPay
    component "APIs Tienda - Lista de Deseos" as ApiWishlist
    component "APIs Usuarios" as ApiUsers
    component "APIs Admin" as ApiAdmin
    component "APIs Opiniones Públicas" as ApiReviews
}

' ===== SERVICIOS EXTERNOS =====
package "Servicios Externos" as ExternalServices {
    component "OpenStreetMap / Geocoding" as OpenStreetMap
    component "Google reCAPTCHA" as Recaptcha
    component "PHPMailer" as EmailService
    component "Google OAuth" as GoogleService
}

' ===== BASE DE DATOS =====
database "Base de Datos MySQL" as DB {
    component "Usuarios y Roles\n(users, users_delivery_backup, login_attempts)" as DBUsers
    component "Catálogo\n(products, categories, collections, sizes, inventory)" as DBCatalogo
    component "Órdenes y Historial\n(orders, order_items, order_status_history)" as DBOrders
    component "Pagos y Comprobantes\npayment_transactions, pay_receipts" as DBPayments
    component "Carrito\n(carts, cart_items)" as DBCart
    component "Lista de Deseos y Alertas\n(wishlist, wishlist_alerts)" as DBWishlist
    component "Contenido\n(announcements, sliders)" as DBContent
    component "Notificaciones\n(user_notifications, admin_notification_dismissals, search_history)" as DBNotifications
    component "Histórico de Envíos\n(order_deliveries, delivery_navigation_sessions, ... )" as DBDelivery
}

' ===== CONEXIONES DEL FLUJO DE COMPRA =====
Inicio --> Catalogo : Explorar catálogo
Catalogo --> Busqueda : Guardar historial
Catalogo --> DetalleProducto : Ver producto
DetalleProducto --> WishlistPublic : Guardar favorito
DetalleProducto --> CheckoutPaso1 : Agregar al carrito
CheckoutPaso1 --> CheckoutPaso2 : Confirmar dirección
CheckoutPaso2 --> CheckoutPaso3 : Seleccionar pago
CheckoutPaso3 --> Confirmacion : Pago registrado
Confirmacion --> UserDashboard : Ver en historial

' ===== CONEXIONES DE AUTENTICACIÓN =====
Login --> RoleRedirect : Autenticación exitosa
Registro --> RoleRedirect : Registro exitoso
GoogleAuth --> RoleRedirect : OAuth completado
RoleRedirect --> UserDashboard : Usuario final
RoleRedirect --> AdminDashboard : Administrador
Middleware --> RoleRedirect : Verificar permisos
Logout --> Inicio : Cerrar sesión

' ===== CONEXIONES DEL PANEL DE USUARIO =====
UserDashboard --> UserPerfil : Gestionar datos
UserDashboard --> UserOrders : Historial
UserDashboard --> UserWishlist : Guardados
UserDashboard --> UserNotifications : Alertas
UserOrders --> UserOrderDetail : Ver detalle
UserOrderDetail --> UserInvoice : Descargar PDF
UserOrders --> UserAjax : Cancelar pedido
UserAddresses --> ApiUsers : Geocodificar
UserAlerts --> ApiUsers : Enviar recordatorios

' ===== CONEXIONES DEL PANEL DE ADMIN =====
AdminDashboard --> AdminProductsList : Gestionar catálogo
AdminProductsList --> AdminAddProduct : Crear producto
AdminProductsList --> AdminEditProduct : Editar producto
AdminProductsList --> AdminCategories : Categorías
AdminProductsList --> AdminCollections : Colecciones
AdminProductsList --> AdminSizes : Tallas
AdminProductsList --> AdminInventory : Stock
AdminDashboard --> AdminOrders : Revisar órdenes
AdminOrders --> AdminOrderTools : Acciones masivas
AdminOrders --> AdminPayments : Validar pagos
AdminOrders --> AdminShipping : Reglas de envío
AdminOrders --> AdminDiscounts : Aplicar cupones
AdminDashboard --> AdminSalesReport : KPIs ventas
AdminDashboard --> AdminProductReport : KPIs productos
AdminDashboard --> AdminClientReport : KPIs clientes
AdminDashboard --> AdminClients : Gestionar clientes
AdminDashboard --> AdminAdmins : Gestionar admins
AdminDashboard --> AdminProfiles : Perfiles/servicios
AdminDashboard --> AdminSettings : Configuración
AdminDashboard --> AdminReviews : Moderar reseñas
AdminDashboard --> AdminAnnouncements : Gestionar anuncios
AdminDashboard --> AdminSliders : Gestionar sliders

' ===== CONEXIONES CON CAPA AJAX / APIS =====
Busqueda --> AjaxSearch
WishlistPublic --> AjaxWishlist
CheckoutPaso1 --> ApiCart
CheckoutPaso3 --> ApiPay
UserWishlist --> ApiWishlist
UserNotifications --> ApiUsers
UserAjax --> ApiUsers
AdminOrders --> ApiAdmin
AdminProductsList --> AjaxAdmin
AdminAnnouncements --> ApiAdmin
ApiReviews --> DetalleProducto

' ===== CONEXIONES CON BASE DE DATOS =====
Inicio --> DBCatalogo : Destacados
Catalogo --> DBCatalogo : Filtrar productos
Busqueda --> DBNotifications : Guardar búsquedas
DetalleProducto --> DBCatalogo : Datos completos
CheckoutPaso1 --> DBCart : Persistir carrito
CheckoutPaso2 --> DBOrders : Dirección y método
CheckoutPaso3 --> DBPayments : Pago y recibos
Confirmacion --> DBOrders : Actualizar estado
WishlistPublic --> DBWishlist : Guardados rápidos
UserWishlist --> DBWishlist : Administrar favoritos
UserOrders --> DBOrders : Historial completo
UserNotifications --> DBNotifications : Bandeja usuario
AdminOrders --> DBOrders : Operaciones
AdminDiscounts --> DBCatalogo : Precios/códigos
AdminAnnouncements --> DBContent : Publicaciones
AdminSliders --> DBContent : Carruseles
AdminClients --> DBUsers : Perfil clientes
AdminAdmins --> DBUsers : Roles admin
AdminProfiles --> DBUsers : Servicios admin
ApiReviews --> DBNotifications : Reacciones útiles
DBDelivery .. DBOrders : Datos históricos

' ===== CONEXIONES CON SERVICIOS EXTERNOS =====
CheckoutPaso3 --> Recaptcha : Validar humano
UserAddresses --> OpenStreetMap : Autocompletar
UserPerfil --> EmailService : Confirmaciones
GoogleAuth --> GoogleService : OAuth

' ===== NOTAS EXPLICATIVAS =====
note right of AlertasFront
    Barra y modales reutilizados para:
    - Alertas de Lista de Deseos
    - Mensajes de stock
    - Promociones urgentes
end note

note right of AdminAnnouncements
  Reemplaza al módulo de news.
  Maneja barra superior y banners
  con prioridad y fechas de vigencia.
end note

note right of InternalAPIs
  Los endpoints AJAX agrupan
  validaciones, conteos en vivo,
  PDF, exportaciones y búsqueda
  inteligente para tienda y panel.
end note

note right of DBDelivery
    Las tablas de envíos siguen
  activas solo para históricos y
    simulaciones. El rol 'delivery' ya no existe en el frontend;
    la gestión de entregas se maneja mediante reglas del sistema
    y/o aplicaciones externas.
end note

note bottom of DB
  Base relacional optimizada con
  más de 80 tablas documentadas,
  triggers de auditoría y soporte
  para migraciones versionadas.
end note

@enduml