@startuml Mapa de Navegación Completo - Angelow
skinparam componentStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam component {
    BackgroundColor #FFFFFF
    BorderColor #333333
    BorderThickness 2
}

title Mapa de Navegación Completo - Sistema Angelow

' ===== USUARIO PÚBLICO / TIENDA =====
package "Tienda Online (Frontend Público)" as Tienda {
    component "Inicio\n(index.php)" as Inicio
    component "Catálogo Global\n(tienda/productos.php)" as Catalogo
    component "Detalle Producto\n(producto/verproducto.php)" as DetalleProducto
    component "Buscador y Guardados\n(ajax/busqueda/*.php)" as Busqueda
    component "Carrito - Paso 1\n(tienda/pagos/cart.php)" as CheckoutPaso1
    component "Paso de Envío\n(tienda/pagos/envio.php)" as CheckoutPaso2
    component "Pago y Comprobantes\n(tienda/pagos/pay.php)" as CheckoutPaso3
    component "Confirmación\n(tienda/pagos/confirmacion.php)" as Confirmacion
    component "Lista de Deseos Rápida\n(tienda/api/wishlist/*.php)" as WishlistPublic
    component "Alertas Promocionales\n(alertas/*.php)" as AlertasFront
}

' ===== AUTENTICACIÓN =====
package "Sistema de Autenticación" as Auth {
    component "Login\n(auth/login.php)" as Login
    component "Registro\n(auth/register.php)" as Registro
    component "Google OAuth\n(auth/google_auth.php)" as GoogleAuth
    component "Middleware Roles\n(auth/auth_middleware.php)" as Middleware
    component "Redirección Roles\n(auth/role_redirect.php)" as RoleRedirect
    component "Logout\n(auth/logout.php)" as Logout
}

' ===== PANEL DE USUARIO =====
package "Panel de Usuario" as UserPanel {
    component "Dashboard Usuario\n(users/dashboarduser.php)" as UserDashboard
    component "Perfil y Seguridad\n(users/settings.php)" as UserPerfil
    component "Mis Órdenes\n(users/orders.php)" as UserOrders
    component "Detalle Orden\n(users/order_detail.php)" as UserOrderDetail
    component "Comprobantes\n(users/orders/invoice.php)" as UserInvoice
    component "Direcciones con GPS\n(users/addresses.php)" as UserAddresses
    component "Lista de Deseos Usuario\n(users/wishlist.php)" as UserWishlist
    component "Alertas Personalizadas\n(users/alertas/*.php)" as UserAlerts
    component "Notificaciones\n(users/notifications.php)" as UserNotifications
    component "Acciones AJAX\n(users/ajax/ajax_cancel_order.php)" as UserAjax
}

' ===== PANEL DE ADMINISTRACIÓN =====
package "Panel de Administración" as AdminPanel {
    component "Dashboard Admin\n(admin/dashboardadmin.php)" as AdminDashboard

    package "Catálogo y Contenido" as AdminCatalogo {
        component "Productos\n(admin/products.php)" as AdminProductsList
        component "Nuevo Producto\n(admin/subproducto.php)" as AdminAddProduct
        component "Edición Producto\n(admin/editproducto.php)" as AdminEditProduct
        component "Categorías\n(admin/categoria/)" as AdminCategories
        component "Colecciones\n(admin/colecciones/)" as AdminCollections
        component "Tallas\n(admin/tallas/)" as AdminSizes
        component "Inventario\n(admin/inventario/)" as AdminInventory
        component "Sliders\n(admin/sliders/)" as AdminSliders
        component "Anuncios\n(admin/announcements/)" as AdminAnnouncements
    }

    package "Ventas y Operaciones" as AdminSales {
        component "Órdenes\n(admin/orders.php)" as AdminOrders
        component "Gestión de Órdenes\n(admin/order/*.php)" as AdminOrderTools
        component "Pagos\n(admin/pagos/define_pay.php)" as AdminPayments
        component "Reglas de Envío\n(admin/envio/)" as AdminShipping
        component "Descuentos Masivos\n(admin/descuento/)" as AdminDiscounts
        component "Reportes Ventas\n(admin/informes/ventas.php)" as AdminSalesReport
        component "Reportes Productos\n(admin/informes/productos.php)" as AdminProductReport
        component "Reportes Clientes\n(admin/informes/clientes.php)" as AdminClientReport
    }

    package "Personas y Configuración" as AdminPeople {
        component "Clientes\n(admin/clientes/)" as AdminClients
        component "Administradores\n(admin/admins/)" as AdminAdmins
        component "Perfiles Admin\n(admin/services/admin_profiles.php)" as AdminProfiles
        component "Ajustes Generales\n(admin/settings/general.php)" as AdminSettings
        component "Reseñas y Preguntas\n(admin/resenas/)" as AdminReviews
    }
}

' ===== CAPA AJAX / APIS INTERNAS =====
package "Capa AJAX y APIs" as InternalAPIs {
    component "AJAX Admin\n(ajax/admin/*)" as AjaxAdmin
    component "AJAX Busquedas\n(ajax/busqueda/*)" as AjaxSearch
    component "AJAX Carrito\n(ajax/cart/*)" as AjaxCart
    component "AJAX Lista de Deseos\n(ajax/wishlist/*)" as AjaxWishlist
    component "APIs Tienda - Carrito\n(tienda/api/cart/*)" as ApiCart
    component "APIs Tienda - Pago\n(tienda/api/pay/*)" as ApiPay
    component "APIs Tienda - Lista de Deseos\n(tienda/api/wishlist/*)" as ApiWishlist
    component "APIs Usuarios\n(users/api/*.php)" as ApiUsers
    component "APIs Admin\n(admin/api/*)" as ApiAdmin
    component "APIs Opiniones Públicas\n(api/*.php)" as ApiReviews
}

' ===== SERVICIOS EXTERNOS =====
package "Servicios Externos" as ExternalServices {
    component "OpenStreetMap / Geocoding" as OpenStreetMap
    component "Google reCAPTCHA" as Recaptcha
    component "PHPMailer" as EmailService
    component "Google OAuth" as GoogleService
}

' ===== BASE DE DATOS =====
database "Base de Datos MySQL" as DB {
    component "Usuarios y Roles\n(users, users_delivery_backup, login_attempts)" as DBUsers
    component "Catálogo\n(products, categories, collections, sizes, inventory)" as DBCatalogo
    component "Órdenes y Historial\n(orders, order_items, order_status_history)" as DBOrders
    component "Pagos y Comprobantes\npayment_transactions, pay_receipts" as DBPayments
    component "Carrito\n(carts, cart_items)" as DBCart
    component "Lista de Deseos y Alertas\n(wishlist, wishlist_alerts)" as DBWishlist
    component "Contenido\n(announcements, sliders)" as DBContent
    component "Notificaciones\n(user_notifications, admin_notification_dismissals, search_history)" as DBNotifications
    component "Histórico Delivery\n(order_deliveries, delivery_navigation_sessions, ... )" as DBDelivery
}

' ===== CONEXIONES DEL FLUJO DE COMPRA =====
Inicio --> Catalogo : Explorar catálogo
Catalogo --> Busqueda : Guardar historial
Catalogo --> DetalleProducto : Ver producto
DetalleProducto --> WishlistPublic : Guardar favorito
DetalleProducto --> CheckoutPaso1 : Agregar al carrito
CheckoutPaso1 --> CheckoutPaso2 : Confirmar dirección
CheckoutPaso2 --> CheckoutPaso3 : Seleccionar pago
CheckoutPaso3 --> Confirmacion : Pago registrado
Confirmacion --> UserDashboard : Ver en historial

' ===== CONEXIONES DE AUTENTICACIÓN =====
Login --> RoleRedirect : Autenticación exitosa
Registro --> RoleRedirect : Registro exitoso
GoogleAuth --> RoleRedirect : OAuth completado
RoleRedirect --> UserDashboard : Usuario final
RoleRedirect --> AdminDashboard : Administrador
Middleware --> RoleRedirect : Verificar permisos
Logout --> Inicio : Cerrar sesión

' ===== CONEXIONES DEL PANEL DE USUARIO =====
UserDashboard --> UserPerfil : Gestionar datos
UserDashboard --> UserOrders : Historial
UserDashboard --> UserWishlist : Guardados
UserDashboard --> UserNotifications : Alertas
UserOrders --> UserOrderDetail : Ver detalle
UserOrderDetail --> UserInvoice : Descargar PDF
UserOrders --> UserAjax : Cancelar pedido
UserAddresses --> ApiUsers : Geocodificar
UserAlerts --> ApiUsers : Enviar recordatorios

' ===== CONEXIONES DEL PANEL DE ADMIN =====
AdminDashboard --> AdminProductsList : Gestionar catálogo
AdminProductsList --> AdminAddProduct : Crear producto
AdminProductsList --> AdminEditProduct : Editar producto
AdminProductsList --> AdminCategories : Categorías
AdminProductsList --> AdminCollections : Colecciones
AdminProductsList --> AdminSizes : Tallas
AdminProductsList --> AdminInventory : Stock
AdminDashboard --> AdminOrders : Revisar órdenes
AdminOrders --> AdminOrderTools : Acciones masivas
AdminOrders --> AdminPayments : Validar pagos
AdminOrders --> AdminShipping : Reglas de envío
AdminOrders --> AdminDiscounts : Aplicar cupones
AdminDashboard --> AdminSalesReport : KPIs ventas
AdminDashboard --> AdminProductReport : KPIs productos
AdminDashboard --> AdminClientReport : KPIs clientes
AdminDashboard --> AdminClients : Gestionar clientes
AdminDashboard --> AdminAdmins : Gestionar admins
AdminDashboard --> AdminProfiles : Perfiles/servicios
AdminDashboard --> AdminSettings : Configuración
AdminDashboard --> AdminReviews : Moderar reseñas
AdminDashboard --> AdminAnnouncements : Gestionar anuncios
AdminDashboard --> AdminSliders : Gestionar sliders

' ===== CONEXIONES CON CAPA AJAX / APIS =====
Busqueda --> AjaxSearch
WishlistPublic --> AjaxWishlist
CheckoutPaso1 --> ApiCart
CheckoutPaso3 --> ApiPay
UserWishlist --> ApiWishlist
UserNotifications --> ApiUsers
UserAjax --> ApiUsers
AdminOrders --> ApiAdmin
AdminProductsList --> AjaxAdmin
AdminAnnouncements --> ApiAdmin
ApiReviews --> DetalleProducto

' ===== CONEXIONES CON BASE DE DATOS =====
Inicio --> DBCatalogo : Destacados
Catalogo --> DBCatalogo : Filtrar productos
Busqueda --> DBNotifications : Guardar búsquedas
DetalleProducto --> DBCatalogo : Datos completos
CheckoutPaso1 --> DBCart : Persistir carrito
CheckoutPaso2 --> DBOrders : Dirección y método
CheckoutPaso3 --> DBPayments : Pago y recibos
Confirmacion --> DBOrders : Actualizar estado
WishlistPublic --> DBWishlist : Guardados rápidos
UserWishlist --> DBWishlist : Administrar favoritos
UserOrders --> DBOrders : Historial completo
UserNotifications --> DBNotifications : Bandeja usuario
AdminOrders --> DBOrders : Operaciones
AdminDiscounts --> DBCatalogo : Precios/códigos
AdminAnnouncements --> DBContent : Publicaciones
AdminSliders --> DBContent : Carruseles
AdminClients --> DBUsers : Perfil clientes
AdminAdmins --> DBUsers : Roles admin
AdminProfiles --> DBUsers : Servicios admin
ApiReviews --> DBNotifications : Reacciones útiles
DBDelivery .. DBOrders : Datos históricos

' ===== CONEXIONES CON SERVICIOS EXTERNOS =====
CheckoutPaso3 --> Recaptcha : Validar humano
UserAddresses --> OpenStreetMap : Autocompletar
UserPerfil --> EmailService : Confirmaciones
GoogleAuth --> GoogleService : OAuth

' ===== NOTAS EXPLICATIVAS =====
note right of AlertasFront
  Barra y modales reutilizados para:
  - Alertas de wishlist
  - Mensajes de stock
  - Promociones urgentes
end note

note right of AdminAnnouncements
  Reemplaza al módulo de news.
  Maneja barra superior y banners
  con prioridad y fechas de vigencia.
end note

note right of InternalAPIs
  Los endpoints AJAX agrupan
  validaciones, conteos en vivo,
  PDF, exportaciones y búsqueda
  inteligente para tienda y panel.
end note

note right of DBDelivery
  Las tablas de delivery siguen
  activas solo para históricos y
  simulaciones. El rol delivery
  fue removido del frontend.
end note

note bottom of DB
  Base relacional optimizada con
  más de 80 tablas documentadas,
  triggers de auditoría y soporte
  para migraciones versionadas.
end note

@enduml