@startuml Mapa de Navegación Actualizado 2025 - Angelow
skinparam componentStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam component {
    BackgroundColor #FFFFFF
    BorderColor #333333
    BorderThickness 2
}

title Mapa de Navegación Actualizado - Sistema Angelow

' ===== TIENDA PÚBLICA =====
package "Tienda Online (Frontend Público)" as Tienda {
    component "Inicio\n(index.php)" as Inicio
    component "Catálogo\n(tienda/productos.php)" as Catalogo
    component "Detalle Producto\n(producto/verproducto.php)" as DetalleProducto
    component "Búsqueda y Tendencias\n(ajax/busqueda/*.php)" as Busquedas
    component "Carrito / Resumen\n(tienda/pagos/cart.php)" as Carrito
    component "Checkout & Envío\n(tienda/pagos/pay.php, envio.php)" as Checkout
    component "Confirmación & Comprobante\n(tienda/pagos/confirmacion.php)" as Confirmacion
    component "Wishlist Pública\n(tienda/api/wishlist/)" as WishlistPublica
}

' ===== AUTENTICACIÓN =====
package "Sistema de Autenticación" as Auth {
    component "Login\n(auth/login.php)" as Login
    component "Registro\n(auth/register.php)" as Registro
    component "Login Google\n(auth/google_auth.php)" as GoogleAuth
    component "Middleware Roles\n(auth/auth_middleware.php)" as Middleware
    component "Redirección Roles\n(auth/role_redirect.php)" as RoleRedirect
}

' ===== PANEL DE USUARIO =====
package "Panel de Usuario" as UserPanel {
    component "Dashboard Usuario\n(users/dashboarduser.php)" as UserDashboard
    component "Perfil y Ajustes\n(users/settings.php)" as UserSettings
    component "Mis Órdenes\n(users/orders.php)" as UserOrders
    component "Detalle / Factura\n(users/order_detail.php, users/orders/invoice.php)" as UserOrderDetail
    component "Direcciones\n(users/addresses.php)" as UserAddresses
    component "Notificaciones\n(users/notifications.php)" as UserNotifications
    component "Wishlist Usuario\n(users/wishlist.php)" as UserWishlist
    component "Alertas Personalizadas\n(users/alertas/alert_user.php)" as UserAlerts
}

' ===== PANEL DE ADMINISTRACIÓN =====
package "Panel de Administración" as AdminPanel {
    component "Dashboard Admin\n(admin/dashboardadmin.php)" as AdminDashboard

    package "Catálogo y Contenido" as AdminCatalogo {
        component "Productos\n(admin/products.php)" as AdminProducts
        component "Nuevo Producto\n(admin/subproducto.php)" as AdminAddProduct
        component "Categorías\n(admin/categoria/)" as AdminCategories
        component "Colecciones\n(admin/colecciones/)" as AdminCollections
        component "Tallas y Variantes\n(admin/tallas/, admin/inventario/)" as AdminVariantes
        component "Sliders\n(admin/sliders/)" as AdminSliders
        component "Anuncios\n(admin/announcements/)" as AdminAnnouncements
    }

    package "Ventas y Operaciones" as AdminVentas {
        component "Órdenes\n(admin/orders.php)" as AdminOrders
        component "Detalle / Edición\n(admin/order/detail.php, edit.php)" as AdminOrderDetail
        component "Pagos\n(admin/pagos/define_pay.php)" as AdminPagos
        component "Reglas de Envío\n(admin/envio/)" as AdminEnvio
        component "Descuentos Masivos\n(admin/descuento/)" as AdminDescuentos
    }

    package "Clientes y Equipo" as AdminPeople {
        component "Clientes\n(admin/clientes/)" as AdminClientes
        component "Administradores\n(admin/admins/)" as AdminAdmins
        component "Servicios internos\n(admin/services/)" as AdminServices
        component "Reseñas / Preguntas\n(admin/resenas/)" as AdminReviews
    }

    package "Informes y Exportaciones" as AdminReports {
        component "Reportes Ventas\n(admin/informes/ventas.php)" as AdminSalesReport
        component "Reportes Productos\n(admin/informes/productos.php)" as AdminProductReport
        component "Reportes Clientes\n(admin/informes/clientes.php)" as AdminClientReport
        component "Exportadores PDF/Excel\n(admin/api/export_*.php)" as AdminExports
    }
}

' ===== SERVICIOS Y APIs INTERNAS =====
package "Servicios Asíncronos y APIs" as Servicios {
    component "AJAX Público\n(ajax/*.php)" as AjaxPublico
    component "APIs Tienda\n(tienda/api/cart|pay|wishlist)" as APIsTienda
    component "APIs Usuario\n(users/api/*.php)" as APIsUsuario
    component "APIs Admin\n(admin/api/*)" as APIsAdmin
    component "APIs Reseñas Públicas\n(api/*.php)" as APIsReviews
    component "Servicios PDF & Correos\n(tienda/api/pay/*.php, PHPMailer)" as ServiciosDocumentos
    component "Configuración Global\n(config.php, settings/site_settings.php)" as Configuracion
}

' ===== BASE DE DATOS =====
database "Base de Datos MySQL" as DB {
    component "Usuarios" as DBUsers
    component "Productos" as DBProducts
    component "Variantes / Stock" as DBInventory
    component "Órdenes" as DBOrders
    component "Pagos" as DBPayments
    component "Carrito" as DBCart
    component "Wishlist" as DBWishlist
    component "Búsquedas" as DBSearch
    component "Notificaciones" as DBNotifications
    component "Descuentos" as DBDiscounts
    component "Auditoría" as DBAudit
}

' ===== FLUJO DE COMPRA =====
Inicio --> Catalogo : Explorar catálogo
Catalogo --> Busquedas : Filtros y tendencias
Catalogo --> DetalleProducto : Ver producto
DetalleProducto --> WishlistPublica : Guardar favorito
DetalleProducto --> Carrito : Agregar al carrito
Carrito --> Checkout : Resumen & dirección
Checkout --> Confirmacion : Pago validado
Confirmacion --> UserDashboard : Orden registrada

' ===== AUTENTICACIÓN =====
Login --> RoleRedirect : Autenticación exitosa
Registro --> RoleRedirect : Registro exitoso
GoogleAuth --> RoleRedirect : OAuth válido
RoleRedirect --> UserDashboard : Usuario
RoleRedirect --> AdminDashboard : Administrador
Middleware --> RoleRedirect : Validar permisos

' ===== PANEL DE USUARIO =====
UserDashboard --> UserSettings : Gestionar perfil
UserDashboard --> UserOrders : Ver historial
UserOrders --> UserOrderDetail : Ver detalle / factura
UserDashboard --> UserAddresses : Gestionar direcciones
UserDashboard --> UserWishlist : Lista personal
UserWishlist --> UserAlerts : Configurar alertas
UserDashboard --> UserNotifications : Ver notificaciones
UserNotifications --> APIsUsuario : Marcar leídas

' ===== PANEL ADMIN =====
AdminDashboard --> AdminProducts : Gestionar catálogo
AdminProducts --> AdminAddProduct : Alta rápida
AdminProducts --> AdminCategories : Clasificar
AdminProducts --> AdminCollections : Curar colecciones
AdminProducts --> AdminVariantes : Gestionar inventario
AdminDashboard --> AdminOrders : Gestionar órdenes
AdminOrders --> AdminOrderDetail : Detalle / edición
AdminOrders --> AdminPagos : Validar comprobantes
AdminOrders --> AdminEnvio : Definir reglas
AdminDashboard --> AdminDescuentos : Campañas masivas
AdminDashboard --> AdminClientes : Seguimiento clientes
AdminDashboard --> AdminAdmins : Gestión equipo
AdminDashboard --> AdminReviews : Moderar reseñas
AdminDashboard --> AdminSalesReport : Reportes ventas
AdminDashboard --> AdminProductReport : Reportes productos
AdminDashboard --> AdminClientReport : Reportes clientes
AdminReports --> AdminExports : Exportar PDF/Excel

' ===== SERVICIOS =====
Catalogo --> AjaxPublico : Búsqueda instantánea
Carrito --> APIsTienda : Actualizar cantidades
Checkout --> APIsTienda : Generar pago / PDF
WishlistPublica --> APIsTienda : Sincronizar
UserDashboard --> APIsUsuario : Direcciones / estado
AdminDashboard --> APIsAdmin : Resumen en tiempo real
AdminReviews --> APIsReviews : Preguntas públicas
ServiciosDocumentos --> AdminReports : Generar reportes
ServiciosDocumentos --> Confirmacion : Enviar comprobantes
Configuracion --> Auth : Parámetros globales
Configuracion --> Tienda : Variables de entorno

' ===== BASE DE DATOS =====
Catalogo --> DBProducts : Listar catálogo
Busquedas --> DBSearch : Guardar historial
Carrito --> DBCart : Actualizar items
Checkout --> DBOrders : Crear orden
Checkout --> DBPayments : Registrar pago
WishlistPublica --> DBWishlist : Guardar favoritos
UserWishlist --> DBWishlist : Sincronizar usuario
UserAddresses --> DBUsers : Direcciones
UserNotifications --> DBNotifications : Estado
AdminProducts --> DBProducts : CRUD productos
AdminVariantes --> DBInventory : Control stock
AdminOrders --> DBOrders : Actualizar estado
AdminPagos --> DBPayments : Validar pagos
AdminDescuentos --> DBDiscounts : Registrar campañas
AdminDashboard --> DBAudit : Eventos críticos

' ===== NOTAS =====
note right of Busquedas
  Motor de búsqueda con:
  - Historial de términos
  - Búsqueda exacta y parcial
  - Persistencia por usuario
end note

note right of UserAlerts
  Alertas por wishlist:
  - Cambios de precio
  - Disponibilidad de stock
  - Recordatorios por correo
end note

note right of AdminDescuentos
  Campañas masivas:
  - Generación de códigos
  - PDF y envíos por correo
  - Segmentación por usuarios
end note

note bottom of DB
  Base optimizada para:
  - Auditoría de eventos
  - Sincronización de wishlist
  - Historial de búsqueda
  - Reportería avanzada
end note

@enduml
